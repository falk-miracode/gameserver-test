(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const f of a)if(f.type==="childList")for(const u of f.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function n(a){const f={};return a.integrity&&(f.integrity=a.integrity),a.referrerPolicy&&(f.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?f.credentials="include":a.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function o(a){if(a.ep)return;a.ep=!0;const f=n(a);fetch(a.href,f)}})();const Ai=!1,_i=(r,t)=>r===t,Ci=Symbol("solid-track"),Yt={equals:_i};let Wr=Xr;const rt=1,Zt=2,Jr={owned:null,cleanups:null,context:null,owner:null};var he=null;let xn=null,$i=null,ue=null,Ee=null,Je=null,on=0;function qt(r,t){const n=ue,o=he,a=r.length===0,f=t===void 0?o:t,u=a?Jr:{owned:null,cleanups:null,context:f?f.context:null,owner:f},h=a?r:()=>r(()=>Ct(()=>_t(u)));he=u,ue=null;try{return Rt(h,!0)}finally{ue=n,he=o}}function Be(r,t){t=t?Object.assign({},Yt,t):Yt;const n={value:r,observers:null,observerSlots:null,comparator:t.equals||void 0},o=a=>(typeof a=="function"&&(a=a(n.value)),Zr(n,a));return[Yr.bind(n),o]}function ut(r,t,n){const o=Dn(r,t,!1,rt);$t(o)}function Ri(r,t,n){Wr=ki;const o=Dn(r,t,!1,rt);o.user=!0,Je?Je.push(o):$t(o)}function Kr(r,t,n){n=n?Object.assign({},Yt,n):Yt;const o=Dn(r,t,!0,0);return o.observers=null,o.observerSlots=null,o.comparator=n.equals||void 0,$t(o),Yr.bind(o)}function Ct(r){if(ue===null)return r();const t=ue;ue=null;try{return r()}finally{ue=t}}function Pi(r){Ri(()=>Ct(r))}function Gr(r){return he===null||(he.cleanups===null?he.cleanups=[r]:he.cleanups.push(r)),r}function Yr(){if(this.sources&&this.state)if(this.state===rt)$t(this);else{const r=Ee;Ee=null,Rt(()=>Qt(this),!1),Ee=r}if(ue){const r=this.observers?this.observers.length:0;ue.sources?(ue.sources.push(this),ue.sourceSlots.push(r)):(ue.sources=[this],ue.sourceSlots=[r]),this.observers?(this.observers.push(ue),this.observerSlots.push(ue.sources.length-1)):(this.observers=[ue],this.observerSlots=[ue.sources.length-1])}return this.value}function Zr(r,t,n){let o=r.value;return(!r.comparator||!r.comparator(o,t))&&(r.value=t,r.observers&&r.observers.length&&Rt(()=>{for(let a=0;a<r.observers.length;a+=1){const f=r.observers[a],u=xn&&xn.running;u&&xn.disposed.has(f),(u?!f.tState:!f.state)&&(f.pure?Ee.push(f):Je.push(f),f.observers&&Qr(f)),u||(f.state=rt)}if(Ee.length>1e6)throw Ee=[],new Error},!1)),t}function $t(r){if(!r.fn)return;_t(r);const t=on;Di(r,r.value,t)}function Di(r,t,n){let o;const a=he,f=ue;ue=he=r;try{o=r.fn(t)}catch(u){return r.pure&&(r.state=rt,r.owned&&r.owned.forEach(_t),r.owned=null),r.updatedAt=n+1,es(u)}finally{ue=f,he=a}(!r.updatedAt||r.updatedAt<=n)&&(r.updatedAt!=null&&"observers"in r?Zr(r,o):r.value=o,r.updatedAt=n)}function Dn(r,t,n,o=rt,a){const f={fn:r,state:o,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:he,context:he?he.context:null,pure:n};return he===null||he!==Jr&&(he.owned?he.owned.push(f):he.owned=[f]),f}function Xt(r){if(r.state===0)return;if(r.state===Zt)return Qt(r);if(r.suspense&&Ct(r.suspense.inFallback))return r.suspense.effects.push(r);const t=[r];for(;(r=r.owner)&&(!r.updatedAt||r.updatedAt<on);)r.state&&t.push(r);for(let n=t.length-1;n>=0;n--)if(r=t[n],r.state===rt)$t(r);else if(r.state===Zt){const o=Ee;Ee=null,Rt(()=>Qt(r,t[0]),!1),Ee=o}}function Rt(r,t){if(Ee)return r();let n=!1;t||(Ee=[]),Je?n=!0:Je=[],on++;try{const o=r();return Ni(n),o}catch(o){n||(Je=null),Ee=null,es(o)}}function Ni(r){if(Ee&&(Xr(Ee),Ee=null),r)return;const t=Je;Je=null,t.length&&Rt(()=>Wr(t),!1)}function Xr(r){for(let t=0;t<r.length;t++)Xt(r[t])}function ki(r){let t,n=0;for(t=0;t<r.length;t++){const o=r[t];o.user?r[n++]=o:Xt(o)}for(t=0;t<n;t++)Xt(r[t])}function Qt(r,t){r.state=0;for(let n=0;n<r.sources.length;n+=1){const o=r.sources[n];if(o.sources){const a=o.state;a===rt?o!==t&&(!o.updatedAt||o.updatedAt<on)&&Xt(o):a===Zt&&Qt(o,t)}}}function Qr(r){for(let t=0;t<r.observers.length;t+=1){const n=r.observers[t];n.state||(n.state=Zt,n.pure?Ee.push(n):Je.push(n),n.observers&&Qr(n))}}function _t(r){let t;if(r.sources)for(;r.sources.length;){const n=r.sources.pop(),o=r.sourceSlots.pop(),a=n.observers;if(a&&a.length){const f=a.pop(),u=n.observerSlots.pop();o<a.length&&(f.sourceSlots[u]=o,a[o]=f,n.observerSlots[o]=u)}}if(r.tOwned){for(t=r.tOwned.length-1;t>=0;t--)_t(r.tOwned[t]);delete r.tOwned}if(r.owned){for(t=r.owned.length-1;t>=0;t--)_t(r.owned[t]);r.owned=null}if(r.cleanups){for(t=r.cleanups.length-1;t>=0;t--)r.cleanups[t]();r.cleanups=null}r.state=0}function Mi(r){return r instanceof Error?r:new Error(typeof r=="string"?r:"Unknown error",{cause:r})}function es(r,t=he){throw Mi(r)}const Li=Symbol("fallback");function Or(r){for(let t=0;t<r.length;t++)r[t]()}function Bi(r,t,n={}){let o=[],a=[],f=[],u=0,h=t.length>1?[]:null;return Gr(()=>Or(f)),()=>{let S=r()||[],v=S.length,$,g;return S[Ci],Ct(()=>{let B,H,U,Y,X,ee,te,q,se;if(v===0)u!==0&&(Or(f),f=[],o=[],a=[],u=0,h&&(h=[])),n.fallback&&(o=[Li],a[0]=qt(Se=>(f[0]=Se,n.fallback())),u=1);else if(u===0){for(a=new Array(v),g=0;g<v;g++)o[g]=S[g],a[g]=qt(F);u=v}else{for(U=new Array(v),Y=new Array(v),h&&(X=new Array(v)),ee=0,te=Math.min(u,v);ee<te&&o[ee]===S[ee];ee++);for(te=u-1,q=v-1;te>=ee&&q>=ee&&o[te]===S[q];te--,q--)U[q]=a[te],Y[q]=f[te],h&&(X[q]=h[te]);for(B=new Map,H=new Array(q+1),g=q;g>=ee;g--)se=S[g],$=B.get(se),H[g]=$===void 0?-1:$,B.set(se,g);for($=ee;$<=te;$++)se=o[$],g=B.get(se),g!==void 0&&g!==-1?(U[g]=a[$],Y[g]=f[$],h&&(X[g]=h[$]),g=H[g],B.set(se,g)):f[$]();for(g=ee;g<v;g++)g in U?(a[g]=U[g],f[g]=Y[g],h&&(h[g]=X[g],h[g](g))):a[g]=qt(F);a=a.slice(0,u=v),o=S.slice(0)}return a});function F(B){if(f[g]=B,h){const[H,U]=Be(g);return h[g]=U,t(S[g],H)}return t(S[g])}}}function ts(r,t){return Ct(()=>r(t||{}))}function ji(r){const t="fallback"in r&&{fallback:()=>r.fallback};return Kr(Bi(()=>r.each,r.children,t||void 0))}const Tt=r=>Kr(()=>r());function Fi(r,t,n){let o=n.length,a=t.length,f=o,u=0,h=0,S=t[a-1].nextSibling,v=null;for(;u<a||h<f;){if(t[u]===n[h]){u++,h++;continue}for(;t[a-1]===n[f-1];)a--,f--;if(a===u){const $=f<o?h?n[h-1].nextSibling:n[f-h]:S;for(;h<f;)r.insertBefore(n[h++],$)}else if(f===h)for(;u<a;)(!v||!v.has(t[u]))&&t[u].remove(),u++;else if(t[u]===n[f-1]&&n[h]===t[a-1]){const $=t[--a].nextSibling;r.insertBefore(n[h++],t[u++].nextSibling),r.insertBefore(n[--f],$),t[a]=n[f]}else{if(!v){v=new Map;let g=h;for(;g<f;)v.set(n[g],g++)}const $=v.get(t[u]);if($!=null)if(h<$&&$<f){let g=u,F=1,B;for(;++g<a&&g<f&&!((B=v.get(t[g]))==null||B!==$+F);)F++;if(F>$-h){const H=t[u];for(;h<$;)r.insertBefore(n[h++],H)}else r.replaceChild(n[h++],t[u++])}else u++;else t[u++].remove()}}}const Ir="_$DX_DELEGATE";function Ui(r,t,n,o={}){let a;return qt(f=>{a=f,t===document?r():Re(t,r(),t.firstChild?null:void 0,n)},o.owner),()=>{a(),t.textContent=""}}function dt(r,t,n,o){let a;const f=()=>{const h=document.createElement("template");return h.innerHTML=r,h.content.firstChild},u=()=>(a||(a=f())).cloneNode(!0);return u.cloneNode=u,u}function Vi(r,t=window.document){const n=t[Ir]||(t[Ir]=new Set);for(let o=0,a=r.length;o<a;o++){const f=r[o];n.has(f)||(n.add(f),t.addEventListener(f,qi))}}function zi(r,t){t==null?r.removeAttribute("class"):r.className=t}function Hi(r,t,n){r.style.setProperty(t,n)}function Re(r,t,n,o){if(n!==void 0&&!o&&(o=[]),typeof t!="function")return en(r,t,o,n);ut(a=>en(r,t(),a,n),o)}function qi(r){let t=r.target;const n=`$$${r.type}`,o=r.target,a=r.currentTarget,f=S=>Object.defineProperty(r,"target",{configurable:!0,value:S}),u=()=>{const S=t[n];if(S&&!t.disabled){const v=t[`${n}Data`];if(v!==void 0?S.call(t,v,r):S.call(t,r),r.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(r.target)&&f(t.host),!0},h=()=>{for(;u()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(r,"currentTarget",{configurable:!0,get(){return t||document}}),r.composedPath){const S=r.composedPath();f(S[0]);for(let v=0;v<S.length-2&&(t=S[v],!!u());v++){if(t._$host){t=t._$host,h();break}if(t.parentNode===a)break}}else h();f(o)}function en(r,t,n,o,a){for(;typeof n=="function";)n=n();if(t===n)return n;const f=typeof t,u=o!==void 0;if(r=u&&n[0]&&n[0].parentNode||r,f==="string"||f==="number"){if(f==="number"&&(t=t.toString(),t===n))return n;if(u){let h=n[0];h&&h.nodeType===3?h.data!==t&&(h.data=t):h=document.createTextNode(t),n=Et(r,n,o,h)}else n!==""&&typeof n=="string"?n=r.firstChild.data=t:n=r.textContent=t}else if(t==null||f==="boolean")n=Et(r,n,o);else{if(f==="function")return ut(()=>{let h=t();for(;typeof h=="function";)h=h();n=en(r,h,n,o)}),()=>n;if(Array.isArray(t)){const h=[],S=n&&Array.isArray(n);if(Tn(h,t,n,a))return ut(()=>n=en(r,h,n,o,!0)),()=>n;if(h.length===0){if(n=Et(r,n,o),u)return n}else S?n.length===0?vr(r,h,o):Fi(r,n,h):(n&&Et(r),vr(r,h));n=h}else if(t.nodeType){if(Array.isArray(n)){if(u)return n=Et(r,n,o,t);Et(r,n,null,t)}else n==null||n===""||!r.firstChild?r.appendChild(t):r.replaceChild(t,r.firstChild);n=t}}return n}function Tn(r,t,n,o){let a=!1;for(let f=0,u=t.length;f<u;f++){let h=t[f],S=n&&n[r.length],v;if(!(h==null||h===!0||h===!1))if((v=typeof h)=="object"&&h.nodeType)r.push(h);else if(Array.isArray(h))a=Tn(r,h,S)||a;else if(v==="function")if(o){for(;typeof h=="function";)h=h();a=Tn(r,Array.isArray(h)?h:[h],Array.isArray(S)?S:[S])||a}else r.push(h),a=!0;else{const $=String(h);S&&S.nodeType===3&&S.data===$?r.push(S):r.push(document.createTextNode($))}}return a}function vr(r,t,n=null){for(let o=0,a=t.length;o<a;o++)r.insertBefore(t[o],n)}function Et(r,t,n,o){if(n===void 0)return r.textContent="";const a=o||document.createTextNode("");if(t.length){let f=!1;for(let u=t.length-1;u>=0;u--){const h=t[u];if(a!==h){const S=h.parentNode===r;!f&&!u?S?r.replaceChild(a,h):r.insertBefore(a,n):S&&h.remove()}else f=!0}}else r.insertBefore(a,n);return[a]}var ns=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Nn(r){if(r.__esModule)return r;var t=r.default;if(typeof t=="function"){var n=function o(){return this instanceof o?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(r).forEach(function(o){var a=Object.getOwnPropertyDescriptor(r,o);Object.defineProperty(n,o,a.get?a:{enumerable:!0,get:function(){return r[o]}})}),n}var rs={};ArrayBuffer.isView||(ArrayBuffer.isView=r=>r!==null&&typeof r=="object"&&r.buffer instanceof ArrayBuffer);typeof FormData>"u"&&(ns.FormData=class{});typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window);var kn={},An=function(r,t){return An=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(n[a]=o[a])},An(r,t)};function ss(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");An(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var tn=function(){return tn=Object.assign||function(t){for(var n,o=1,a=arguments.length;o<a;o++){n=arguments[o];for(var f in n)Object.prototype.hasOwnProperty.call(n,f)&&(t[f]=n[f])}return t},tn.apply(this,arguments)};function is(r,t){var n={};for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&t.indexOf(o)<0&&(n[o]=r[o]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,o=Object.getOwnPropertySymbols(r);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(r,o[a])&&(n[o[a]]=r[o[a]]);return n}function os(r,t,n,o){var a=arguments.length,f=a<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,n):o,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(r,t,n,o);else for(var h=r.length-1;h>=0;h--)(u=r[h])&&(f=(a<3?u(f):a>3?u(t,n,f):u(t,n))||f);return a>3&&f&&Object.defineProperty(t,n,f),f}function as(r,t){return function(n,o){t(n,o,r)}}function cs(r,t,n,o,a,f){function u(X){if(X!==void 0&&typeof X!="function")throw new TypeError("Function expected");return X}for(var h=o.kind,S=h==="getter"?"get":h==="setter"?"set":"value",v=!t&&r?o.static?r:r.prototype:null,$=t||(v?Object.getOwnPropertyDescriptor(v,o.name):{}),g,F=!1,B=n.length-1;B>=0;B--){var H={};for(var U in o)H[U]=U==="access"?{}:o[U];for(var U in o.access)H.access[U]=o.access[U];H.addInitializer=function(X){if(F)throw new TypeError("Cannot add initializers after decoration has completed");f.push(u(X||null))};var Y=(0,n[B])(h==="accessor"?{get:$.get,set:$.set}:$[S],H);if(h==="accessor"){if(Y===void 0)continue;if(Y===null||typeof Y!="object")throw new TypeError("Object expected");(g=u(Y.get))&&($.get=g),(g=u(Y.set))&&($.set=g),(g=u(Y.init))&&a.unshift(g)}else(g=u(Y))&&(h==="field"?a.unshift(g):$[S]=g)}v&&Object.defineProperty(v,o.name,$),F=!0}function fs(r,t,n){for(var o=arguments.length>2,a=0;a<t.length;a++)n=o?t[a].call(r,n):t[a].call(r);return o?n:void 0}function ls(r){return typeof r=="symbol"?r:"".concat(r)}function us(r,t,n){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(r,"name",{configurable:!0,value:n?"".concat(n," ",t):t})}function ds(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)}function hs(r,t,n,o){function a(f){return f instanceof n?f:new n(function(u){u(f)})}return new(n||(n=Promise))(function(f,u){function h($){try{v(o.next($))}catch(g){u(g)}}function S($){try{v(o.throw($))}catch(g){u(g)}}function v($){$.done?f($.value):a($.value).then(h,S)}v((o=o.apply(r,t||[])).next())})}function gs(r,t){var n={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},o,a,f,u=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return u.next=h(0),u.throw=h(1),u.return=h(2),typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function h(v){return function($){return S([v,$])}}function S(v){if(o)throw new TypeError("Generator is already executing.");for(;u&&(u=0,v[0]&&(n=0)),n;)try{if(o=1,a&&(f=v[0]&2?a.return:v[0]?a.throw||((f=a.return)&&f.call(a),0):a.next)&&!(f=f.call(a,v[1])).done)return f;switch(a=0,f&&(v=[v[0]&2,f.value]),v[0]){case 0:case 1:f=v;break;case 4:return n.label++,{value:v[1],done:!1};case 5:n.label++,a=v[1],v=[0];continue;case 7:v=n.ops.pop(),n.trys.pop();continue;default:if(f=n.trys,!(f=f.length>0&&f[f.length-1])&&(v[0]===6||v[0]===2)){n=0;continue}if(v[0]===3&&(!f||v[1]>f[0]&&v[1]<f[3])){n.label=v[1];break}if(v[0]===6&&n.label<f[1]){n.label=f[1],f=v;break}if(f&&n.label<f[2]){n.label=f[2],n.ops.push(v);break}f[2]&&n.ops.pop(),n.trys.pop();continue}v=t.call(r,n)}catch($){v=[6,$],a=0}finally{o=f=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}var an=Object.create?function(r,t,n,o){o===void 0&&(o=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(r,o,a)}:function(r,t,n,o){o===void 0&&(o=n),r[o]=t[n]};function ms(r,t){for(var n in r)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&an(t,r,n)}function nn(r){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&r[t],o=0;if(n)return n.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&o>=r.length&&(r=void 0),{value:r&&r[o++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Mn(r,t){var n=typeof Symbol=="function"&&r[Symbol.iterator];if(!n)return r;var o=n.call(r),a,f=[],u;try{for(;(t===void 0||t-- >0)&&!(a=o.next()).done;)f.push(a.value)}catch(h){u={error:h}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(u)throw u.error}}return f}function ps(){for(var r=[],t=0;t<arguments.length;t++)r=r.concat(Mn(arguments[t]));return r}function ys(){for(var r=0,t=0,n=arguments.length;t<n;t++)r+=arguments[t].length;for(var o=Array(r),a=0,t=0;t<n;t++)for(var f=arguments[t],u=0,h=f.length;u<h;u++,a++)o[a]=f[u];return o}function ws(r,t,n){if(n||arguments.length===2)for(var o=0,a=t.length,f;o<a;o++)(f||!(o in t))&&(f||(f=Array.prototype.slice.call(t,0,o)),f[o]=t[o]);return r.concat(f||Array.prototype.slice.call(t))}function Ot(r){return this instanceof Ot?(this.v=r,this):new Ot(r)}function bs(r,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=n.apply(r,t||[]),a,f=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),h("next"),h("throw"),h("return",u),a[Symbol.asyncIterator]=function(){return this},a;function u(B){return function(H){return Promise.resolve(H).then(B,g)}}function h(B,H){o[B]&&(a[B]=function(U){return new Promise(function(Y,X){f.push([B,U,Y,X])>1||S(B,U)})},H&&(a[B]=H(a[B])))}function S(B,H){try{v(o[B](H))}catch(U){F(f[0][3],U)}}function v(B){B.value instanceof Ot?Promise.resolve(B.value.v).then($,g):F(f[0][2],B)}function $(B){S("next",B)}function g(B){S("throw",B)}function F(B,H){B(H),f.shift(),f.length&&S(f[0][0],f[0][1])}}function Es(r){var t,n;return t={},o("next"),o("throw",function(a){throw a}),o("return"),t[Symbol.iterator]=function(){return this},t;function o(a,f){t[a]=r[a]?function(u){return(n=!n)?{value:Ot(r[a](u)),done:!1}:f?f(u):u}:f}}function xs(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=r[Symbol.asyncIterator],n;return t?t.call(r):(r=typeof nn=="function"?nn(r):r[Symbol.iterator](),n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n);function o(f){n[f]=r[f]&&function(u){return new Promise(function(h,S){u=r[f](u),a(h,S,u.done,u.value)})}}function a(f,u,h,S){Promise.resolve(S).then(function(v){f({value:v,done:h})},u)}}function Os(r,t){return Object.defineProperty?Object.defineProperty(r,"raw",{value:t}):r.raw=t,r}var Wi=Object.create?function(r,t){Object.defineProperty(r,"default",{enumerable:!0,value:t})}:function(r,t){r.default=t},_n=function(r){return _n=Object.getOwnPropertyNames||function(t){var n=[];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[n.length]=o);return n},_n(r)};function Is(r){if(r&&r.__esModule)return r;var t={};if(r!=null)for(var n=_n(r),o=0;o<n.length;o++)n[o]!=="default"&&an(t,r,n[o]);return Wi(t,r),t}function vs(r){return r&&r.__esModule?r:{default:r}}function Ss(r,t,n,o){if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?r!==t||!o:!t.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?o:n==="a"?o.call(r):o?o.value:t.get(r)}function Ts(r,t,n,o,a){if(o==="m")throw new TypeError("Private method is not writable");if(o==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?r!==t||!a:!t.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return o==="a"?a.call(r,n):a?a.value=n:t.set(r,n),n}function As(r,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof r=="function"?t===r:r.has(t)}function _s(r,t,n){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var o,a;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");o=t[Symbol.asyncDispose]}if(o===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");o=t[Symbol.dispose],n&&(a=o)}if(typeof o!="function")throw new TypeError("Object not disposable.");a&&(o=function(){try{a.call(this)}catch(f){return Promise.reject(f)}}),r.stack.push({value:t,dispose:o,async:n})}else n&&r.stack.push({async:!0});return t}var Ji=typeof SuppressedError=="function"?SuppressedError:function(r,t,n){var o=new Error(n);return o.name="SuppressedError",o.error=r,o.suppressed=t,o};function Cs(r){function t(f){r.error=r.hasError?new Ji(f,r.error,"An error was suppressed during disposal."):f,r.hasError=!0}var n,o=0;function a(){for(;n=r.stack.pop();)try{if(!n.async&&o===1)return o=0,r.stack.push(n),Promise.resolve().then(a);if(n.dispose){var f=n.dispose.call(n.value);if(n.async)return o|=2,Promise.resolve(f).then(a,function(u){return t(u),a()})}else o|=1}catch(u){t(u)}if(o===1)return r.hasError?Promise.reject(r.error):Promise.resolve();if(r.hasError)throw r.error}return a()}function $s(r,t){return typeof r=="string"&&/^\.\.?\//.test(r)?r.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(n,o,a,f,u){return o?t?".jsx":".js":a&&(!f||!u)?n:a+f+"."+u.toLowerCase()+"js"}):r}const Ki={__extends:ss,__assign:tn,__rest:is,__decorate:os,__param:as,__esDecorate:cs,__runInitializers:fs,__propKey:ls,__setFunctionName:us,__metadata:ds,__awaiter:hs,__generator:gs,__createBinding:an,__exportStar:ms,__values:nn,__read:Mn,__spread:ps,__spreadArrays:ys,__spreadArray:ws,__await:Ot,__asyncGenerator:bs,__asyncDelegator:Es,__asyncValues:xs,__makeTemplateObject:Os,__importStar:Is,__importDefault:vs,__classPrivateFieldGet:Ss,__classPrivateFieldSet:Ts,__classPrivateFieldIn:As,__addDisposableResource:_s,__disposeResources:Cs,__rewriteRelativeImportExtension:$s},Gi=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:_s,get __assign(){return tn},__asyncDelegator:Es,__asyncGenerator:bs,__asyncValues:xs,__await:Ot,__awaiter:hs,__classPrivateFieldGet:Ss,__classPrivateFieldIn:As,__classPrivateFieldSet:Ts,__createBinding:an,__decorate:os,__disposeResources:Cs,__esDecorate:cs,__exportStar:ms,__extends:ss,__generator:gs,__importDefault:vs,__importStar:Is,__makeTemplateObject:Os,__metadata:ds,__param:as,__propKey:ls,__read:Mn,__rest:is,__rewriteRelativeImportExtension:$s,__runInitializers:fs,__setFunctionName:us,__spread:ps,__spreadArray:ws,__spreadArrays:ys,__values:nn,default:Ki},Symbol.toStringTag,{value:"Module"})),cn=Nn(Gi);var Pt={};(function(r){r.CloseCode=void 0,function(o){o[o.CONSENTED=4e3]="CONSENTED",o[o.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(r.CloseCode||(r.CloseCode={}));class t extends Error{constructor(a,f){super(f),this.name="ServerError",this.code=a}}class n extends Error{constructor(a){super(a),this.name="AbortError"}}r.AbortError=n,r.ServerError=t})(Pt);var Ln={},Rs={},Ps={},Cn={exports:{}};(function(r,t){(function(n,o){o(t)})(ns,function(n){n.OPERATION=void 0,function(l){l[l.ADD=128]="ADD",l[l.REPLACE=0]="REPLACE",l[l.DELETE=64]="DELETE",l[l.DELETE_AND_MOVE=96]="DELETE_AND_MOVE",l[l.MOVE_AND_ADD=160]="MOVE_AND_ADD",l[l.DELETE_AND_ADD=192]="DELETE_AND_ADD",l[l.CLEAR=10]="CLEAR",l[l.REVERSE=15]="REVERSE",l[l.MOVE=32]="MOVE",l[l.DELETE_BY_REFID=33]="DELETE_BY_REFID",l[l.ADD_BY_REFID=129]="ADD_BY_REFID"}(n.OPERATION||(n.OPERATION={})),Symbol.metadata??=Symbol.for("Symbol.metadata");const f="~track",u="~encoder",h="~decoder",S="~filter",v="~getByIndex",$="~deleteByIndex",g="~changes",F="~childType",B="~onEncodeEnd",H="~onDecodeEnd",U="~descriptors",Y="~__numFields",X="~__refTypeFieldIndexes",ee="~__viewFieldIndexes",te="$__fieldIndexesByViewTag";let q;try{q=new TextEncoder}catch{}const se=new ArrayBuffer(8),Se=new Int32Array(se),ze=new Float32Array(se),Ge=new Float64Array(se),Ae=new BigInt64Array(se),Z=typeof Buffer<"u"&&Buffer.byteLength?Buffer.byteLength:function(l,e){for(var s=0,i=0,c=0,d=l.length;c<d;c++)s=l.charCodeAt(c),s<128?i+=1:s<2048?i+=2:s<55296||s>=57344?i+=3:(c++,i+=4);return i};function Q(l,e,s){for(var i=0,c=0,d=e.length;c<d;c++)i=e.charCodeAt(c),i<128?l[s.offset++]=i:i<2048?(l[s.offset]=192|i>>6,l[s.offset+1]=128|i&63,s.offset+=2):i<55296||i>=57344?(l[s.offset]=224|i>>12,l[s.offset+1]=128|i>>6&63,l[s.offset+2]=128|i&63,s.offset+=3):(c++,i=65536+((i&1023)<<10|e.charCodeAt(c)&1023),l[s.offset]=240|i>>18,l[s.offset+1]=128|i>>12&63,l[s.offset+2]=128|i>>6&63,l[s.offset+3]=128|i&63,s.offset+=4)}function w(l,e,s){l[s.offset++]=e&255}function P(l,e,s){l[s.offset++]=e&255}function R(l,e,s){l[s.offset++]=e&255,l[s.offset++]=e>>8&255}function A(l,e,s){l[s.offset++]=e&255,l[s.offset++]=e>>8&255}function _(l,e,s){l[s.offset++]=e&255,l[s.offset++]=e>>8&255,l[s.offset++]=e>>16&255,l[s.offset++]=e>>24&255}function j(l,e,s){const i=e>>24,c=e>>16,d=e>>8,p=e;l[s.offset++]=p&255,l[s.offset++]=d&255,l[s.offset++]=c&255,l[s.offset++]=i&255}function z(l,e,s){const i=Math.floor(e/Math.pow(2,32)),c=e>>>0;j(l,c,s),j(l,i,s)}function V(l,e,s){const i=e/Math.pow(2,32)>>0,c=e>>>0;j(l,c,s),j(l,i,s)}function J(l,e,s){Ae[0]=BigInt.asIntN(64,e),_(l,Se[0],s),_(l,Se[1],s)}function K(l,e,s){Ae[0]=BigInt.asIntN(64,e),_(l,Se[0],s),_(l,Se[1],s)}function ie(l,e,s){ze[0]=e,_(l,Se[0],s)}function de(l,e,s){Ge[0]=e,_(l,Se[0],s),_(l,Se[1],s)}function Te(l,e,s){l[s.offset++]=e?1:0}function It(l,e,s){e||(e="");let i=Z(e,"utf8"),c=0;if(i<32)l[s.offset++]=i|160,c=1;else if(i<256)l[s.offset++]=217,l[s.offset++]=i%255,c=2;else if(i<65536)l[s.offset++]=218,A(l,i,s),c=3;else if(i<4294967296)l[s.offset++]=219,j(l,i,s),c=5;else throw new Error("String too long");return Q(l,e,s),c+i}function st(l,e,s){if(isNaN(e))return st(l,0,s);if(isFinite(e)){if(e!==(e|0))return Math.abs(e)<=34028235e31&&(ze[0]=e,Math.abs(Math.abs(ze[0])-Math.abs(e))<1e-4)?(l[s.offset++]=202,ie(l,e,s),5):(l[s.offset++]=203,de(l,e,s),9)}else return st(l,e>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER,s);return e>=0?e<128?(l[s.offset++]=e&255,1):e<256?(l[s.offset++]=204,l[s.offset++]=e&255,2):e<65536?(l[s.offset++]=205,A(l,e,s),3):e<4294967296?(l[s.offset++]=206,j(l,e,s),5):(l[s.offset++]=207,V(l,e,s),9):e>=-32?(l[s.offset++]=224|e+32,1):e>=-128?(l[s.offset++]=208,w(l,e,s),2):e>=-32768?(l[s.offset++]=209,R(l,e,s),3):e>=-2147483648?(l[s.offset++]=210,_(l,e,s),5):(l[s.offset++]=211,z(l,e,s),9)}const Oe={int8:w,uint8:P,int16:R,uint16:A,int32:_,uint32:j,int64:z,uint64:V,bigint64:J,biguint64:K,float32:ie,float64:de,boolean:Te,string:It,number:st,utf8Write:Q,utf8Length:Z},vt=new ArrayBuffer(8),it=new Int32Array(vt),ni=new Float32Array(vt),ri=new Float64Array(vt),si=new BigUint64Array(vt),ii=new BigInt64Array(vt);function Kn(l,e,s){for(var i="",c=0,d=e.offset,p=e.offset+s;d<p;d++){var I=l[d];if(!(I&128)){i+=String.fromCharCode(I);continue}if((I&224)===192){i+=String.fromCharCode((I&31)<<6|l[++d]&63);continue}if((I&240)===224){i+=String.fromCharCode((I&15)<<12|(l[++d]&63)<<6|(l[++d]&63)<<0);continue}if((I&248)===240){c=(I&7)<<18|(l[++d]&63)<<12|(l[++d]&63)<<6|(l[++d]&63)<<0,c>=65536?(c-=65536,i+=String.fromCharCode((c>>>10)+55296,(c&1023)+56320)):i+=String.fromCharCode(c);continue}console.error("Invalid byte "+I.toString(16))}return e.offset+=s,i}function Gn(l,e){return St(l,e)<<24>>24}function St(l,e){return l[e.offset++]}function Yn(l,e){return kt(l,e)<<16>>16}function kt(l,e){return l[e.offset++]|l[e.offset++]<<8}function Me(l,e){return l[e.offset++]|l[e.offset++]<<8|l[e.offset++]<<16|l[e.offset++]<<24}function gt(l,e){return Me(l,e)>>>0}function Zn(l,e){return it[0]=Me(l,e),ni[0]}function Xn(l,e){return it[0]=Me(l,e),it[1]=Me(l,e),ri[0]}function Qn(l,e){const s=gt(l,e);return Me(l,e)*Math.pow(2,32)+s}function er(l,e){const s=gt(l,e);return gt(l,e)*Math.pow(2,32)+s}function oi(l,e){return it[0]=Me(l,e),it[1]=Me(l,e),ii[0]}function ai(l,e){return it[0]=Me(l,e),it[1]=Me(l,e),si[0]}function ci(l,e){return St(l,e)>0}function fi(l,e){const s=l[e.offset++];let i;return s<192?i=s&31:s===217?i=St(l,e):s===218?i=kt(l,e):s===219&&(i=gt(l,e)),Kn(l,e,i)}function li(l,e){const s=l[e.offset++];if(s<128)return s;if(s===202)return Zn(l,e);if(s===203)return Xn(l,e);if(s===204)return St(l,e);if(s===205)return kt(l,e);if(s===206)return gt(l,e);if(s===207)return er(l,e);if(s===208)return Gn(l,e);if(s===209)return Yn(l,e);if(s===210)return Me(l,e);if(s===211)return Qn(l,e);if(s>223)return(255-s+1)*-1}function ui(l,e){const s=l[e.offset];return s<192&&s>160||s===217||s===218||s===219}const _e={utf8Read:Kn,int8:Gn,uint8:St,int16:Yn,uint16:kt,int32:Me,uint32:gt,float32:Zn,float64:Xn,int64:Qn,uint64:er,bigint64:oi,biguint64:ai,boolean:ci,string:fi,number:li,stringCheck:ui},pn={},di=new Map;function Fe(l,e){e.constructor&&(di.set(e.constructor,l),pn[l]=e),e.encode&&(Oe[l]=e.encode),e.decode&&(_e[l]=e.decode)}function yn(l){return pn[l]}function hi(l){for(const e in l)Fe(e,l[e]);return e=>Le(e)}class Ie{static{this.inheritedTypes=new Map}static{this.cachedContexts=new Map}static register(e){const s=Object.getPrototypeOf(e);if(s!==ae){let i=Ie.inheritedTypes.get(s);i||(i=new Set,Ie.inheritedTypes.set(s,i)),i.add(e)}}static cache(e){let s=Ie.cachedContexts.get(e);return s||(s=new Ie(e),Ie.cachedContexts.set(e,s)),s}constructor(e){this.types={},this.schemas=new Map,this.hasFilters=!1,this.parentFiltered={},e&&this.discoverTypes(e)}has(e){return this.schemas.has(e)}get(e){return this.types[e]}add(e,s=this.schemas.size){return this.schemas.has(e)?!1:(this.types[s]=e,e[Symbol.metadata]===void 0&&ye.initialize(e),this.schemas.set(e,s),!0)}getTypeId(e){return this.schemas.get(e)}discoverTypes(e,s,i,c){if(c&&this.registerFilteredByParent(e,s,i),!this.add(e))return;Ie.inheritedTypes.get(e)?.forEach(I=>{this.discoverTypes(I,s,i,c)});let d=e;for(;(d=Object.getPrototypeOf(d))&&d!==ae&&d!==Function.prototype;)this.discoverTypes(d);const p=e[Symbol.metadata]??={};p[ee]&&(this.hasFilters=!0);for(const I in p){const E=I,b=p[E].type,O=p[E].tag!==void 0;if(typeof b!="string")if(typeof b=="function")this.discoverTypes(b,e,E,c||O);else{const T=Object.values(b)[0];if(typeof T=="string")continue;this.discoverTypes(T,e,E,c||O)}}}registerFilteredByParent(e,s,i){let d=`${this.schemas.get(e)??this.schemas.size}`;s&&(d+=`-${this.schemas.get(s)}`),d+=`-${i}`,this.parentFiltered[d]=!0}debug(){let e="";for(const s in this.parentFiltered){const i=s.split("-").map(Number),c=i.pop();e+=`
		`,e+=`${s}: ${i.reverse().map((d,p)=>{const I=this.types[d],E=I[Symbol.metadata];let b=I.name;return p===0&&(b+=`[${E[c].name}]`),`${b}`}).join(" -> ")}`}return`TypeContext ->
	Schema types: ${this.schemas.size}
	hasFilters: ${this.hasFilters}
	parentFiltered:${e}`}}function Ye(l){if(Array.isArray(l))return{array:Ye(l[0])};if(typeof l.type<"u")return l.type;if(gi(l))return Object.keys(l).every(e=>typeof l[e]=="string")?"string":"number";if(typeof l=="object"&&l!==null){const e=Object.keys(l).find(s=>pn[s]!==void 0);if(e)return l[e]=Ye(l[e]),l}return l}function gi(l){if(typeof l=="function"&&l[Symbol.metadata])return!1;const e=Object.keys(l),s=e.filter(i=>/\d+/.test(i));return!!(s.length>0&&s.length===e.length/2&&l[l[s[0]]]==s[0]||e.length>0&&e.every(i=>typeof l[i]=="string"&&l[i]===i))}const ye={addField(l,e,s,i,c){if(e>64)throw new Error(`Can't define field '${s}'.
Schema instances may only have up to 64 fields.`);l[e]=Object.assign(l[e]||{},{type:Ye(i),index:e,name:s}),Object.defineProperty(l,U,{value:l[U]||{},enumerable:!1,configurable:!0}),c?(l[U][s]=c,l[U][`_${s}`]={value:void 0,writable:!0,enumerable:!1,configurable:!0}):l[U][s]={value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(l,Y,{value:e,enumerable:!1,configurable:!0}),Object.defineProperty(l,s,{value:e,enumerable:!1,configurable:!0}),typeof l[e].type!="string"&&(l[X]===void 0&&Object.defineProperty(l,X,{value:[],enumerable:!1,configurable:!0}),l[X].push(e))},setTag(l,e,s){const i=l[e],c=l[i];c.tag=s,l[ee]||(Object.defineProperty(l,ee,{value:[],enumerable:!1,configurable:!0}),Object.defineProperty(l,te,{value:{},enumerable:!1,configurable:!0})),l[ee].push(i),l[te][s]||(l[te][s]=[]),l[te][s].push(i)},setFields(l,e){const s=l.prototype.constructor;Ie.register(s);const i=Object.getPrototypeOf(s),c=i&&i[Symbol.metadata],d=ye.initialize(s);s[f]||(s[f]=ae[f]),s[u]||(s[u]=ae[u]),s[h]||(s[h]=ae[h]),s.prototype.toJSON||(s.prototype.toJSON=ae.prototype.toJSON);let p=d[Y]??(c&&c[Y])??-1;p++;for(const I in e){const E=Ye(e[I]),b=typeof Object.keys(E)[0]=="string"&&yn(Object.keys(E)[0]),O=b?Object.values(E)[0]:E;ye.addField(d,p,I,E,pr(`_${I}`,p,O,b)),p++}return l},isDeprecated(l,e){return l[e].deprecated===!0},init(l){const e={};l[Symbol.metadata]=e,Object.defineProperty(e,Y,{value:0,enumerable:!1,configurable:!0})},initialize(l){const e=Object.getPrototypeOf(l),s=e[Symbol.metadata];let i=l[Symbol.metadata]??Object.create(null);return e!==ae&&i===s&&(i=Object.create(null),s&&(Object.setPrototypeOf(i,s),Object.defineProperty(i,Y,{value:s[Y],enumerable:!1,configurable:!0,writable:!0}),s[ee]!==void 0&&(Object.defineProperty(i,ee,{value:[...s[ee]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(i,te,{value:{...s[te]},enumerable:!1,configurable:!0,writable:!0})),s[X]!==void 0&&Object.defineProperty(i,X,{value:[...s[X]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(i,U,{value:{...s[U]},enumerable:!1,configurable:!0,writable:!0}))),l[Symbol.metadata]=i,i},isValidInstance(l){return l.constructor[Symbol.metadata]&&Object.prototype.hasOwnProperty.call(l.constructor[Symbol.metadata],Y)},getFields(l){const e=l[Symbol.metadata],s={};for(let i=0;i<=e[Y];i++)s[e[i].name]=e[i].type;return s},hasViewTagAtIndex(l,e){return l?.[ee]?.includes(e)}};function He(l){return{indexes:{},operations:[],queueRootNode:l}}function mt(){return{next:void 0,tail:void 0}}function Ce(l,e){const s=l.indexes[e];s===void 0?l.indexes[e]=l.operations.push(e)-1:l.operations[s]=e}function tr(l,e){let s=l.indexes[e];s===void 0&&(s=Object.values(l.indexes).at(-1),e=Object.entries(l.indexes).find(([i,c])=>c===s)?.[0]),l.operations[s]=void 0,delete l.indexes[e]}class pt{constructor(e){this.isFiltered=!1,this.indexedOperations={},this.changes={indexes:{},operations:[]},this.allChanges={indexes:{},operations:[]},this.isNew=!0,this.ref=e,this.metadata=e.constructor[Symbol.metadata],this.metadata?.[ee]&&(this.allFilteredChanges={indexes:{},operations:[]},this.filteredChanges={indexes:{},operations:[]})}setRoot(e){this.root=e;const s=this.root.add(this);this.checkIsFiltered(this.parent,this.parentIndex,s),s&&this.forEachChild((i,c)=>{i.root!==e?i.setRoot(e):e.add(i)})}setParent(e,s,i){if(this.addParent(e,i),!s)return;const c=s.add(this);s!==this.root&&(this.root=s,this.checkIsFiltered(e,i,c)),c&&this.forEachChild((d,p)=>{if(d.root===s){s.add(d),s.moveNextToParent(d);return}d.setParent(this.ref,s,p)})}forEachChild(e){if(this.ref[F]){if(typeof this.ref[F]!="string")for(const[s,i]of this.ref.entries())e(i[g],this.indexes?.[s]??s)}else for(const s of this.metadata?.[X]??[]){const i=this.metadata[s],c=this.ref[i.name];c&&e(c[g],s)}}operation(e){this.filteredChanges!==void 0?(this.filteredChanges.operations.push(-e),this.root?.enqueueChangeTree(this,"filteredChanges")):(this.changes.operations.push(-e),this.root?.enqueueChangeTree(this,"changes"))}change(e,s=n.OPERATION.ADD){const i=this.isFiltered||this.metadata?.[e]?.tag!==void 0,c=i?this.filteredChanges:this.changes,d=this.indexedOperations[e];if(!d||d===n.OPERATION.DELETE){const p=d&&d===n.OPERATION.DELETE?n.OPERATION.DELETE_AND_ADD:s;this.indexedOperations[e]=p}Ce(c,e),i?(Ce(this.allFilteredChanges,e),this.root&&(this.root.enqueueChangeTree(this,"filteredChanges"),this.root.enqueueChangeTree(this,"allFilteredChanges"))):(Ce(this.allChanges,e),this.root?.enqueueChangeTree(this,"changes"))}shiftChangeIndexes(e){const s=this.isFiltered?this.filteredChanges:this.changes,i={},c={};for(const d in this.indexedOperations)i[Number(d)+e]=this.indexedOperations[d],c[Number(d)+e]=s.indexes[d];this.indexedOperations=i,s.indexes=c,s.operations=s.operations.map(d=>d+e)}shiftAllChangeIndexes(e,s=0){this.filteredChanges!==void 0?(this._shiftAllChangeIndexes(e,s,this.allFilteredChanges),this._shiftAllChangeIndexes(e,s,this.allChanges)):this._shiftAllChangeIndexes(e,s,this.allChanges)}_shiftAllChangeIndexes(e,s=0,i){const c={};let d=0;for(const p in i.indexes)c[d++]=i.indexes[p];i.indexes=c;for(let p=0;p<i.operations.length;p++){const I=i.operations[p];I>s&&(i.operations[p]=I+e)}}indexedOperation(e,s,i=e){this.indexedOperations[e]=s,this.filteredChanges!==void 0?(Ce(this.allFilteredChanges,i),Ce(this.filteredChanges,e),this.root?.enqueueChangeTree(this,"filteredChanges")):(Ce(this.allChanges,i),Ce(this.changes,e),this.root?.enqueueChangeTree(this,"changes"))}getType(e){return this.ref[F]||this.metadata[e].type}getChange(e){return this.indexedOperations[e]}getValue(e,s=!1){return this.ref[v](e,s)}delete(e,s,i=e){if(e===void 0){try{throw new Error(`@colyseus/schema ${this.ref.constructor.name}: trying to delete non-existing index '${e}'`)}catch(p){console.warn(p)}return}const c=this.filteredChanges!==void 0?this.filteredChanges:this.changes;this.indexedOperations[e]=s??n.OPERATION.DELETE,Ce(c,e),tr(this.allChanges,i);const d=this.getValue(e);return d&&d[g]&&this.root?.remove(d[g]),this.filteredChanges!==void 0?(tr(this.allFilteredChanges,i),this.root?.enqueueChangeTree(this,"filteredChanges")):this.root?.enqueueChangeTree(this,"changes"),d}endEncode(e){this.indexedOperations={},this[e]=He(),this.ref[B]?.(),this.isNew=!1}discard(e=!1){this.ref[B]?.(),this.indexedOperations={},this.changes=He(this.changes.queueRootNode),this.filteredChanges!==void 0&&(this.filteredChanges=He(this.filteredChanges.queueRootNode)),e&&(this.allChanges=He(this.allChanges.queueRootNode),this.allFilteredChanges!==void 0&&(this.allFilteredChanges=He(this.allFilteredChanges.queueRootNode)))}discardAll(){const e=Object.keys(this.indexedOperations);for(let s=0,i=e.length;s<i;s++){const c=this.getValue(Number(e[s]));c&&c[g]&&c[g].discardAll()}this.discard()}get changed(){return Object.entries(this.indexedOperations).length>0}checkIsFiltered(e,s,i){this.root.types.hasFilters&&(this._checkFilteredByParent(e,s),this.filteredChanges!==void 0&&(this.root?.enqueueChangeTree(this,"filteredChanges"),i&&this.root?.enqueueChangeTree(this,"allFilteredChanges"))),this.isFiltered||(this.root?.enqueueChangeTree(this,"changes"),i&&this.root?.enqueueChangeTree(this,"allChanges"))}_checkFilteredByParent(e,s){if(!e)return;const i=ye.isValidInstance(this.ref)?this.ref.constructor:this.ref[F];let c,d=!ye.isValidInstance(e);d?(c=e[g],e=c.parent,s=c.parentIndex):c=e[g];const p=e.constructor;let I=`${this.root.types.getTypeId(i)}`;p&&(I+=`-${this.root.types.schemas.get(p)}`),I+=`-${s}`;const E=ye.hasViewTagAtIndex(p?.[Symbol.metadata],s);this.isFiltered=e[g].isFiltered||this.root.types.parentFiltered[I]||E,this.isFiltered&&(this.isVisibilitySharedWithParent=c.isFiltered&&typeof i!="string"&&!E&&d,this.filteredChanges||(this.filteredChanges=He(),this.allFilteredChanges=He()),this.changes.operations.length>0&&(this.changes.operations.forEach(b=>Ce(this.filteredChanges,b)),this.allChanges.operations.forEach(b=>Ce(this.allFilteredChanges,b)),this.changes=He(),this.allChanges=He()))}get parent(){return this.parentChain?.ref}get parentIndex(){return this.parentChain?.index}addParent(e,s){if(this.hasParent((i,c)=>i[g]===e[g])){this.parentChain.index=s;return}this.parentChain={ref:e,index:s,next:this.parentChain}}removeParent(e=this.parent){let s=this.parentChain,i=null;for(;s;){if(s.ref[g]===e[g])return i?i.next=s.next:this.parentChain=s.next,!0;i=s,s=s.next}return this.parentChain===void 0}findParent(e){let s=this.parentChain;for(;s;){if(e(s.ref,s.index))return s;s=s.next}}hasParent(e){return this.findParent(e)!==void 0}getAllParents(){const e=[];let s=this.parentChain;for(;s;)e.push({ref:s.ref,index:s.index}),s=s.next;return e}}function wn(l,e,s,i,c,d){typeof s=="string"?Oe[s]?.(e,i,d):s[Symbol.metadata]!==void 0?(Oe.number(e,i[g].refId,d),(c&n.OPERATION.ADD)===n.OPERATION.ADD&&l.tryEncodeTypeId(e,s,i.constructor,d)):Oe.number(e,i[g].refId,d)}const nr=function(l,e,s,i,c,d,p,I,E){if(e[d.offset++]=(i|c)&255,c===n.OPERATION.DELETE)return;const b=s.ref,O=E[i];wn(l,e,E[i].type,b[O.name],c,d)},Mt=function(l,e,s,i,c,d){if(e[d.offset++]=c&255,Oe.number(e,i,d),c===n.OPERATION.DELETE)return;const p=s.ref;if((c&n.OPERATION.ADD)===n.OPERATION.ADD&&typeof p.set=="function"){const b=s.ref.$indexes.get(i);Oe.string(e,b,d)}const I=p[F],E=p[v](i);wn(l,e,I,E,c,d)},rr=function(l,e,s,i,c,d,p,I){const E=s.ref,b=I&&s.isFiltered&&typeof s.getType(i)!="string";let O;if(b){const k=E.tmpItems[i];if(!k)return;O=k[g].refId,c===n.OPERATION.DELETE?c=n.OPERATION.DELETE_BY_REFID:c===n.OPERATION.ADD&&(c=n.OPERATION.ADD_BY_REFID)}else O=i;if(e[d.offset++]=c&255,Oe.number(e,O,d),c===n.OPERATION.DELETE||c===n.OPERATION.DELETE_BY_REFID)return;const T=s.getType(i),L=s.getValue(i,p);wn(l,e,T,L,c,d)},sr=-1;function bn(l,e,s,i,c,d,p,I){const E=l.root,b=s[v](i);let O;if((e&n.OPERATION.DELETE)===n.OPERATION.DELETE){const T=E.refIds.get(b);T!==void 0&&E.removeRef(T),e!==n.OPERATION.DELETE_AND_ADD&&s[$](i),O=void 0}if(e!==n.OPERATION.DELETE)if(ae.is(c)){const T=_e.number(d,p);if(O=E.refs.get(T),(e&n.OPERATION.ADD)===n.OPERATION.ADD){const L=l.getInstanceType(d,p,c);O||(O=l.createInstanceOfType(L)),E.addRef(T,O,O!==b||e===n.OPERATION.DELETE_AND_ADD&&O===b)}}else if(typeof c=="string")O=_e[c](d,p);else{const T=yn(Object.keys(c)[0]),L=_e.number(d,p),k=E.refs.has(L)?b||E.refs.get(L):new T.constructor;if(O=k.clone(!0),O[F]=Object.values(c)[0],b){let D=E.refIds.get(b);if(D!==void 0&&L!==D){const C=b.entries();let M;for(;(M=C.next())&&!M.done;){const[ce,fe]=M.value;typeof fe=="object"&&(D=E.refIds.get(fe),E.removeRef(D)),I.push({ref:b,refId:D,op:n.OPERATION.DELETE,field:ce,value:void 0,previousValue:fe})}}}E.addRef(L,O,k!==b||e===n.OPERATION.DELETE_AND_ADD&&k===b)}return{value:O,previousValue:b}}const ir=function(l,e,s,i,c){const d=e[s.offset++],p=i.constructor[Symbol.metadata],I=d>>6<<6,E=d%(I||255),b=p[E];if(b===void 0)return console.warn("@colyseus/schema: field not defined at",{index:E,ref:i.constructor.name,metadata:p}),sr;const{value:O,previousValue:T}=bn(l,I,i,E,b.type,e,s,c);O!=null&&(i[b.name]=O),T!==O&&c.push({ref:i,refId:l.currentRefId,op:I,field:b.name,value:O,previousValue:T})},Lt=function(l,e,s,i,c){const d=e[s.offset++];if(d===n.OPERATION.CLEAR){l.removeChildRefs(i,c),i.clear();return}const p=_e.number(e,s),I=i[F];let E;(d&n.OPERATION.ADD)===n.OPERATION.ADD?typeof i.set=="function"?(E=_e.string(e,s),i.setIndex(p,E)):E=p:E=i.getIndex(p);const{value:b,previousValue:O}=bn(l,d,i,p,I,e,s,c);if(b!=null){if(typeof i.set=="function")i.$items.set(E,b);else if(typeof i.$setAt=="function")i.$setAt(p,b,d);else if(typeof i.add=="function"){const T=i.add(b);typeof T=="number"&&i.setIndex(T,T)}}O!==b&&c.push({ref:i,refId:l.currentRefId,op:d,field:"",dynamicIndex:E,value:b,previousValue:O})},mi=function(l,e,s,i,c){let d=e[s.offset++],p;if(d===n.OPERATION.CLEAR){l.removeChildRefs(i,c),i.clear();return}else if(d===n.OPERATION.REVERSE){i.reverse();return}else if(d===n.OPERATION.DELETE_BY_REFID){const T=_e.number(e,s),L=l.root.refs.get(T);p=i.findIndex(k=>k===L),i[$](p),c.push({ref:i,refId:l.currentRefId,op:n.OPERATION.DELETE,field:"",dynamicIndex:p,value:void 0,previousValue:L});return}else if(d===n.OPERATION.ADD_BY_REFID){const T=_e.number(e,s),L=l.root.refs.get(T);L&&(p=i.findIndex(k=>k===L)),(p===-1||p===void 0)&&(p=i.length)}else p=_e.number(e,s);const I=i[F];let E=p;const{value:b,previousValue:O}=bn(l,d,i,p,I,e,s,c);b!=null&&b!==O&&i.$setAt(p,b,d),O!==b&&c.push({ref:i,refId:l.currentRefId,op:d,field:"",dynamicIndex:E,value:b,previousValue:O})};class or extends Error{}function pi(l,e,s,i){let c,d=!1;switch(e){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":c="number",isNaN(l)&&console.log(`trying to encode "NaN" in ${s.constructor.name}#${i}`);break;case"bigint64":case"biguint64":c="bigint";break;case"string":c="string",d=!0;break;case"boolean":return;default:return}if(typeof l!==c&&(!d||d&&l!==null)){let p=`'${JSON.stringify(l)}'${l&&l.constructor&&` (${l.constructor.name})`||""}`;throw new or(`a '${c}' was expected, but ${p} was provided in ${s.constructor.name}#${i}`)}}function Bt(l,e,s,i){if(!(l instanceof e))throw new or(`a '${e.name}' was expected, but '${l&&l.constructor.name}' was provided in ${s.constructor.name}#${i}`)}var ar,cr;const yi=(l,e)=>{const s=l.toString(),i=e.toString();return s<i?-1:s>i?1:0};class we{static{this[ar]=rr}static{this[cr]=mi}static[(ar=u,cr=h,S)](e,s,i){return!i||typeof e[F]=="string"||i.isChangeTreeVisible(e.tmpItems[s]?.[g])}static is(e){return Array.isArray(e)||e.array!==void 0}static from(e){return new we(...Array.from(e))}constructor(...e){this.items=[],this.tmpItems=[],this.deletedIndexes={},this.isMovingItems=!1,Object.defineProperty(this,F,{value:void 0,enumerable:!1,writable:!0,configurable:!0});const s=new Proxy(this,{get:(i,c)=>typeof c!="symbol"&&!isNaN(c)?this.items[c]:Reflect.get(i,c),set:(i,c,d)=>{if(typeof c!="symbol"&&!isNaN(c)){if(d==null)i.$deleteAt(c);else{if(d[g]){Bt(d,i[F],i,c);const p=i.items[c];i.isMovingItems?(p!==void 0?d[g].isNew?i[g].indexedOperation(Number(c),n.OPERATION.MOVE_AND_ADD):(i[g].getChange(Number(c))&n.OPERATION.DELETE)===n.OPERATION.DELETE?i[g].indexedOperation(Number(c),n.OPERATION.DELETE_AND_MOVE):i[g].indexedOperation(Number(c),n.OPERATION.MOVE):d[g].isNew&&i[g].indexedOperation(Number(c),n.OPERATION.ADD),d[g].setParent(this,i[g].root,c)):i.$changeAt(Number(c),d),p!==void 0&&p[g].root?.remove(p[g])}else i.$changeAt(Number(c),d);i.items[c]=d,i.tmpItems[c]=d}return!0}else return Reflect.set(i,c,d)},deleteProperty:(i,c)=>(typeof c=="number"?i.$deleteAt(c):delete i[c],!0),has:(i,c)=>typeof c!="symbol"&&!isNaN(Number(c))?Reflect.has(this.items,c):Reflect.has(i,c)});return Object.defineProperty(this,g,{value:new pt(s),enumerable:!1,writable:!0}),e.length>0&&this.push(...e),s}set length(e){e===0?this.clear():e<this.items.length?this.splice(e,this.length-e):console.warn("ArraySchema: can't set .length to a higher value than its length.")}get length(){return this.items.length}push(...e){let s=this.tmpItems.length;const i=this[g];for(let c=0,d=e.length;c<d;c++,s++){const p=e[c];if(p==null)return;typeof p=="object"&&this[F]&&Bt(p,this[F],this,c),i.indexedOperation(s,n.OPERATION.ADD,this.items.length),this.items.push(p),this.tmpItems.push(p),p[g]?.setParent(this,i.root,s)}return s}pop(){let e=-1;for(let s=this.tmpItems.length-1;s>=0;s--)if(this.deletedIndexes[s]!==!0){e=s;break}if(!(e<0))return this[g].delete(e,void 0,this.items.length-1),this.deletedIndexes[e]=!0,this.items.pop()}at(e){return e<0&&(e+=this.length),this.items[e]}$changeAt(e,s){if(s==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.items[e]===s)return;const i=this.items[e]!==void 0?typeof s=="object"?n.OPERATION.DELETE_AND_ADD:n.OPERATION.REPLACE:n.OPERATION.ADD,c=this[g];c.change(e,i),s[g]?.setParent(this,c.root,e)}$deleteAt(e,s){this[g].delete(e,s)}$setAt(e,s,i){e===0&&i===n.OPERATION.ADD&&this.items[e]!==void 0?this.items.unshift(s):i===n.OPERATION.DELETE_AND_MOVE?(this.items.splice(e,1),this.items[e]=s):this.items[e]=s}clear(){if(this.items.length===0)return;const e=this[g];e.forEachChild((s,i)=>{e.root?.remove(s)}),e.discard(!0),e.operation(n.OPERATION.CLEAR),this.items.length=0,this.tmpItems.length=0}concat(...e){return new we(...this.items.concat(...e))}join(e){return this.items.join(e)}reverse(){return this[g].operation(n.OPERATION.REVERSE),this.items.reverse(),this.tmpItems.reverse(),this}shift(){if(this.items.length===0)return;const e=this[g],s=this.tmpItems.findIndex(c=>c===this.items[0]),i=this.items.findIndex(c=>c===this.items[0]);return e.delete(s,n.OPERATION.DELETE,i),e.shiftAllChangeIndexes(-1,i),this.deletedIndexes[s]=!0,this.items.shift()}slice(e,s){const i=new we;return i.push(...this.items.slice(e,s)),i}sort(e=yi){this.isMovingItems=!0;const s=this[g];return this.items.sort(e).forEach((c,d)=>s.change(d,n.OPERATION.REPLACE)),this.tmpItems.sort(e),this.isMovingItems=!1,this}splice(e,s,...i){const c=this[g],d=this.items.length,p=this.tmpItems.length,I=i.length,E=[];for(let b=0;b<p;b++)this.deletedIndexes[b]!==!0&&E.push(b);if(d>e){s===void 0&&(s=d-e);for(let b=e;b<e+s;b++){const O=E[b];c.delete(O,n.OPERATION.DELETE),this.deletedIndexes[O]=!0}}else s=0;if(I>0){if(I>s)throw console.error("Inserting more elements than deleting during ArraySchema#splice()"),new Error("ArraySchema#splice(): insertCount must be equal or lower than deleteCount.");for(let b=0;b<I;b++){const O=(E[e]??d)+b;c.indexedOperation(O,this.deletedIndexes[O]?n.OPERATION.DELETE_AND_ADD:n.OPERATION.ADD),i[b][g]?.setParent(this,c.root,O)}}return s>I&&c.shiftAllChangeIndexes(-(s-I),E[e+I]),c.filteredChanges!==void 0?c.root?.enqueueChangeTree(c,"filteredChanges"):c.root?.enqueueChangeTree(c,"changes"),this.items.splice(e,s,...i)}unshift(...e){const s=this[g];return s.shiftChangeIndexes(e.length),s.isFiltered?Ce(s.filteredChanges,this.items.length):Ce(s.allChanges,this.items.length),e.forEach((i,c)=>{s.change(c,n.OPERATION.ADD)}),this.tmpItems.unshift(...e),this.items.unshift(...e)}indexOf(e,s){return this.items.indexOf(e,s)}lastIndexOf(e,s=this.length-1){return this.items.lastIndexOf(e,s)}every(e,s){return this.items.every(e,s)}some(e,s){return this.items.some(e,s)}forEach(e,s){return this.items.forEach(e,s)}map(e,s){return this.items.map(e,s)}filter(e,s){return this.items.filter(e,s)}reduce(e,s){return this.items.reduce(e,s)}reduceRight(e,s){return this.items.reduceRight(e,s)}find(e,s){return this.items.find(e,s)}findIndex(e,s){return this.items.findIndex(e,s)}fill(e,s,i){throw new Error("ArraySchema#fill() not implemented")}copyWithin(e,s,i){throw new Error("ArraySchema#copyWithin() not implemented")}toString(){return this.items.toString()}toLocaleString(){return this.items.toLocaleString()}[Symbol.iterator](){return this.items[Symbol.iterator]()}static get[Symbol.species](){return we}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}includes(e,s){return this.items.includes(e,s)}flatMap(e,s){throw new Error("ArraySchema#flatMap() is not supported.")}flat(e){throw new Error("ArraySchema#flat() is not supported.")}findLast(){return this.items.findLast.apply(this.items,arguments)}findLastIndex(...e){return this.items.findLastIndex.apply(this.items,arguments)}with(e,s){const i=this.items.slice();return e<0&&(e+=this.length),i[e]=s,new we(...i)}toReversed(){return this.items.slice().reverse()}toSorted(e){return this.items.slice().sort(e)}toSpliced(e,s,...i){return this.items.toSpliced.apply(copy,arguments)}shuffle(){return this.move(e=>{let s=this.items.length;for(;s!=0;){let i=Math.floor(Math.random()*s);s--,[this[s],this[i]]=[this[i],this[s]]}})}move(e){return this.isMovingItems=!0,e(this),this.isMovingItems=!1,this}[v](e,s=!1){return s?this.items[e]:this.deletedIndexes[e]?this.items[e]:this.tmpItems[e]||this.items[e]}[$](e){this.items[e]=void 0,this.tmpItems[e]=void 0}[B](){this.tmpItems=this.items.slice(),this.deletedIndexes={}}[H](){this.items=this.items.filter(e=>e!==void 0),this.tmpItems=this.items.slice()}toArray(){return this.items.slice(0)}toJSON(){return this.toArray().map(e=>typeof e.toJSON=="function"?e.toJSON():e)}clone(e){let s;return e?(s=new we,s.push(...this.items)):s=new we(...this.map(i=>i[g]?i.clone():i)),s}}Fe("array",{constructor:we});var fr,lr;class Pe{static{this[fr]=Mt}static{this[lr]=Lt}static[(fr=u,lr=h,S)](e,s,i){return!i||typeof e[F]=="string"||i.isChangeTreeVisible((e[v](s)??e.deletedItems[s])[g])}static is(e){return e.map!==void 0}constructor(e){this.$items=new Map,this.$indexes=new Map,this.deletedItems={};const s=new pt(this);if(s.indexes={},Object.defineProperty(this,g,{value:s,enumerable:!1,writable:!0}),e)if(e instanceof Map||e instanceof Pe)e.forEach((i,c)=>this.set(c,i));else for(const i in e)this.set(i,e[i]);Object.defineProperty(this,F,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}[Symbol.iterator](){return this.$items[Symbol.iterator]()}get[Symbol.toStringTag](){return this.$items[Symbol.toStringTag]}static get[Symbol.species](){return Pe}set(e,s){if(s==null)throw new Error(`MapSchema#set('${e}', ${s}): trying to set ${s} value on '${e}'.`);typeof s=="object"&&this[F]&&Bt(s,this[F],this,e),e=e.toString();const i=this[g],c=s[g]!==void 0;let d,p;if(typeof i.indexes[e]<"u"){d=i.indexes[e],p=n.OPERATION.REPLACE;const I=this.$items.get(e);if(I===s)return;c&&(p=n.OPERATION.DELETE_AND_ADD,I!==void 0&&I[g].root?.remove(I[g])),this.deletedItems[d]&&delete this.deletedItems[d]}else d=i.indexes[Y]??0,p=n.OPERATION.ADD,this.$indexes.set(d,e),i.indexes[e]=d,i.indexes[Y]=d+1;return this.$items.set(e,s),i.change(d,p),c&&s[g].setParent(this,i.root,d),this}get(e){return this.$items.get(e)}delete(e){const s=this[g].indexes[e];return this.deletedItems[s]=this[g].delete(s),this.$items.delete(e)}clear(){const e=this[g];e.discard(!0),e.indexes={},e.forEachChild((s,i)=>{e.root?.remove(s)}),this.$indexes.clear(),this.$items.clear(),e.operation(n.OPERATION.CLEAR)}has(e){return this.$items.has(e)}forEach(e){this.$items.forEach(e)}entries(){return this.$items.entries()}keys(){return this.$items.keys()}values(){return this.$items.values()}get size(){return this.$items.size}setIndex(e,s){this.$indexes.set(e,s)}getIndex(e){return this.$indexes.get(e)}[v](e){return this.$items.get(this.$indexes.get(e))}[$](e){const s=this.$indexes.get(e);this.$items.delete(s),this.$indexes.delete(e)}[B](){const e=this[g];for(const s in this.deletedItems){const i=parseInt(s),c=this.$indexes.get(i);delete e.indexes[c],this.$indexes.delete(i)}this.deletedItems={}}toJSON(){const e={};return this.forEach((s,i)=>{e[i]=typeof s.toJSON=="function"?s.toJSON():s}),e}clone(e){let s;return e?s=Object.assign(new Pe,this):(s=new Pe,this.forEach((i,c)=>{i[g]?s.set(c,i.clone()):s.set(c,i)})),s}}Fe("map",{constructor:Pe});var ur,dr;class ot{static{this[ur]=Mt}static{this[dr]=Lt}static[(ur=u,dr=h,S)](e,s,i){return!i||typeof e[F]=="string"||i.isChangeTreeVisible((e[v](s)??e.deletedItems[s])[g])}static is(e){return e.collection!==void 0}constructor(e){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[g]=new pt(this),this[g].indexes={},e&&e.forEach(s=>this.add(s)),Object.defineProperty(this,F,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(e){const s=this.$refId++;return e[g]!==void 0&&e[g].setParent(this,this[g].root,s),this[g].indexes[s]=s,this.$indexes.set(s,s),this.$items.set(s,e),this[g].change(s),s}at(e){const s=Array.from(this.$items.keys())[e];return this.$items.get(s)}entries(){return this.$items.entries()}delete(e){const s=this.$items.entries();let i,c;for(;(c=s.next())&&!c.done;)if(e===c.value[1]){i=c.value[0];break}return i===void 0?!1:(this.deletedItems[i]=this[g].delete(i),this.$indexes.delete(i),this.$items.delete(i))}clear(){const e=this[g];e.discard(!0),e.indexes={},e.forEachChild((s,i)=>{e.root?.remove(s)}),this.$indexes.clear(),this.$items.clear(),e.operation(n.OPERATION.CLEAR)}has(e){return Array.from(this.$items.values()).some(s=>s===e)}forEach(e){this.$items.forEach((s,i,c)=>e(s,i,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(e,s){this.$indexes.set(e,s)}getIndex(e){return this.$indexes.get(e)}[v](e){return this.$items.get(this.$indexes.get(e))}[$](e){const s=this.$indexes.get(e);this.$items.delete(s),this.$indexes.delete(e)}[B](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const e=[];return this.forEach((s,i)=>{e.push(typeof s.toJSON=="function"?s.toJSON():s)}),e}clone(e){let s;return e?s=Object.assign(new ot,this):(s=new ot,this.forEach(i=>{i[g]?s.add(i.clone()):s.add(i)})),s}}Fe("collection",{constructor:ot});var hr,gr;class at{static{this[hr]=Mt}static{this[gr]=Lt}static[(hr=u,gr=h,S)](e,s,i){return!i||typeof e[F]=="string"||i.visible.has((e[v](s)??e.deletedItems[s])[g])}static is(e){return e.set!==void 0}constructor(e){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[g]=new pt(this),this[g].indexes={},e&&e.forEach(s=>this.add(s)),Object.defineProperty(this,F,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(e){if(this.has(e))return!1;const s=this.$refId++;e[g]!==void 0&&e[g].setParent(this,this[g].root,s);const i=this[g].indexes[s]?.op??n.OPERATION.ADD;return this[g].indexes[s]=s,this.$indexes.set(s,s),this.$items.set(s,e),this[g].change(s,i),s}entries(){return this.$items.entries()}delete(e){const s=this.$items.entries();let i,c;for(;(c=s.next())&&!c.done;)if(e===c.value[1]){i=c.value[0];break}return i===void 0?!1:(this.deletedItems[i]=this[g].delete(i),this.$indexes.delete(i),this.$items.delete(i))}clear(){const e=this[g];e.discard(!0),e.indexes={},this.$indexes.clear(),this.$items.clear(),e.operation(n.OPERATION.CLEAR)}has(e){const s=this.$items.values();let i=!1,c;for(;(c=s.next())&&!c.done;)if(e===c.value){i=!0;break}return i}forEach(e){this.$items.forEach((s,i,c)=>e(s,i,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(e,s){this.$indexes.set(e,s)}getIndex(e){return this.$indexes.get(e)}[v](e){return this.$items.get(this.$indexes.get(e))}[$](e){const s=this.$indexes.get(e);this.$items.delete(s),this.$indexes.delete(e)}[B](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const e=[];return this.forEach((s,i)=>{e.push(typeof s.toJSON=="function"?s.toJSON():s)}),e}clone(e){let s;return e?s=Object.assign(new at,this):(s=new at,this.forEach(i=>{i[g]?s.add(i.clone()):s.add(i)})),s}}Fe("set",{constructor:at});const qe=-1;function wi(l){return Ie.register(l),l}function mr(l=qe){return function(e,s){const i=e.constructor,d=Object.getPrototypeOf(i)[Symbol.metadata],p=i[Symbol.metadata]??=Object.assign({},i[Symbol.metadata],d??Object.create(null));ye.setTag(p,s,l)}}function Le(l,e){return function(s,i){const c=s.constructor;if(!l)throw new Error(`${c.name}: @type() reference provided for "${i}" is undefined. Make sure you don't have any circular dependencies.`);l=Ye(l),Ie.register(c);const p=Object.getPrototypeOf(c)[Symbol.metadata],I=ye.initialize(c);let E=I[i];if(I[E]!==void 0){if(I[E].deprecated)return;if(I[E].type!==void 0)try{throw new Error(`@colyseus/schema: Duplicate '${i}' definition on '${c.name}'.
Check @type() annotation`)}catch(b){const O=b.stack.split(`
`)[4].trim();throw new Error(`${b.message} ${O}`)}}else E=I[Y]??(p&&p[Y])??-1,E++;if(e&&e.manual)ye.addField(I,E,i,l,{enumerable:!0,configurable:!0,writable:!0});else{const b=typeof Object.keys(l)[0]=="string"&&yn(Object.keys(l)[0]),O=b?Object.values(l)[0]:l;ye.addField(I,E,i,l,pr(`_${i}`,E,O,b))}}}function pr(l,e,s,i){return{get:function(){return this[l]},set:function(c){const d=this[l]??void 0;if(c!==d){if(c!=null){i?(i.constructor===we&&!(c instanceof we)&&(c=new we(...c)),i.constructor===Pe&&!(c instanceof Pe)&&(c=new Pe(c)),c[F]=s):typeof s!="string"?Bt(c,s,this,l.substring(1)):pi(c,s,this,l.substring(1));const p=this[g];d!==void 0&&d[g]?(p.root?.remove(d[g]),this.constructor[f](p,e,n.OPERATION.DELETE_AND_ADD)):this.constructor[f](p,e,n.OPERATION.ADD),c[g]?.setParent(this,p.root,e)}else d!==void 0&&this[g].delete(e);this[l]=c}},enumerable:!0,configurable:!0}}function bi(l=!0){return function(e,s){const i=e.constructor,d=Object.getPrototypeOf(i)[Symbol.metadata],p=i[Symbol.metadata]??=Object.assign({},i[Symbol.metadata],d??Object.create(null)),I=p[s];p[I].deprecated=!0,l&&(p[U]??={},p[U][s]={get:function(){throw new Error(`${s} is deprecated.`)},set:function(E){},enumerable:!1,configurable:!0}),Object.defineProperty(p,I,{value:p[I],enumerable:!1,configurable:!0})}}function Ei(l,e,s){for(let i in e)Le(e[i],s)(l.prototype,i);return l}function yr(l,e,s=ae){const i={},c={},d={},p={};for(let b in l){const O=l[b];typeof O=="object"?(O.view!==void 0&&(p[b]=typeof O.view=="boolean"?qe:O.view),i[b]=Ye(O),Object.prototype.hasOwnProperty.call(O,"default")?d[b]=O.default:Array.isArray(O)||O.array!==void 0?d[b]=new we:O.map!==void 0?d[b]=new Pe:O.collection!==void 0?d[b]=new ot:O.set!==void 0?d[b]=new at:O.type!==void 0&&ae.is(O.type)&&(d[b]=new O.type)):typeof O=="function"?ae.is(O)?(d[b]=new O,i[b]=Ye(O)):c[b]=O:i[b]=Ye(O)}const I=()=>{const b={};for(const O in d){const T=d[O];T&&typeof T.clone=="function"?b[O]=T.clone():b[O]=T}return b},E=ye.setFields(class extends s{constructor(...b){b[0]=Object.assign({},I(),b[0]),super(...b)}},i);for(let b in p)mr(p[b])(E.prototype,b);for(let b in c)E.prototype[b]=c[b];return e&&Object.defineProperty(E,"name",{value:e}),E.extends=(b,O)=>yr(b,O,E),E}function jt(l){return new Array(l).fill(0).map((e,s)=>s===l-1?"└─ ":"   ").join("")}function xi(l){const e=l[g].root,s={ops:{},refs:[]};let i=e.changes.next;for(;i;){const c=i.changeTree;if(c===void 0){i=i.next;continue}const d=c.indexedOperations;s.refs.push(`refId#${c.refId}`);for(const p in d){const I=d[p],E=n.OPERATION[I];s.ops[E]||(s.ops[E]=0),s.ops[n.OPERATION[I]]++}i=i.next}return s}var wr,br;class ae{static{this[wr]=nr}static{this[br]=ir}static initialize(e){Object.defineProperty(e,g,{value:new pt(e),enumerable:!1,writable:!0}),Object.defineProperties(e,e.constructor[Symbol.metadata]?.[U]||{})}static is(e){return typeof e[Symbol.metadata]=="object"}static[(wr=u,br=h,f)](e,s,i=n.OPERATION.ADD){e.change(s,i)}static[S](e,s,i){const d=e.constructor[Symbol.metadata][s]?.tag;if(i===void 0)return d===void 0;if(d===void 0)return!0;if(d===qe)return i.isChangeTreeVisible(e[g]);{const p=i.tags?.get(e[g]);return p&&p.has(d)}}constructor(...e){ae.initialize(this),e[0]&&Object.assign(this,e[0])}assign(e){return Object.assign(this,e),this}setDirty(e,s){const i=this.constructor[Symbol.metadata];this[g].change(i[i[e]].index,s)}clone(){const e=new this.constructor,s=this.constructor[Symbol.metadata];for(const i in s){const c=s[i].name;typeof this[c]=="object"&&typeof this[c]?.clone=="function"?e[c]=this[c].clone():e[c]=this[c]}return e}toJSON(){const e={},s=this.constructor[Symbol.metadata];for(const i in s){const c=s[i],d=c.name;!c.deprecated&&this[d]!==null&&typeof this[d]<"u"&&(e[d]=typeof this[d].toJSON=="function"?this[d].toJSON():this[d])}return e}discardAllChanges(){this[g].discardAll()}[v](e){const s=this.constructor[Symbol.metadata];return this[s[e].name]}[$](e){const s=this.constructor[Symbol.metadata];this[s[e].name]=void 0}static debugRefIds(e,s=!1,i=0,c,d=""){const p=s?` - ${JSON.stringify(e.toJSON())}`:"",I=e[g],E=c?c.root.refIds.get(e):I.refId,b=c?c.root:I.root,O=b?.refCount?.[E]>1?` [×${b.refCount[E]}]`:"";let T=`${jt(i)}${d}${e.constructor.name} (refId: ${E})${O}${p}
`;return I.forEachChild((L,k)=>{let D=k;typeof k=="number"&&e.$indexes&&(D=e.$indexes.get(k)??k);const C=e.forEach!==void 0&&D!==void 0?`["${D}"]: `:"";T+=this.debugRefIds(L.ref,s,i+1,c,C)}),T}static debugRefIdEncodingOrder(e,s="allChanges"){let i=[],c=e[g].root[s].next;for(;c;)c.changeTree&&i.push(c.changeTree.refId),c=c.next;return i}static debugRefIdsFromDecoder(e){return this.debugRefIds(e.state,!1,0,e)}static debugChanges(e,s=!1){const i=e[g],c=s?i.allChanges:i.changes,d=s?"allChanges":"changes";let p=`${e.constructor.name} (${i.refId}) -> .${d}:
`;function I(E){E.operations.filter(b=>b).forEach(b=>{const O=i.indexedOperations[b];p+=`- [${b}]: ${n.OPERATION[O]} (${JSON.stringify(i.getValue(Number(b),s))})
`})}return I(c),!s&&i.filteredChanges&&i.filteredChanges.operations.filter(E=>E).length>0&&(p+=`${e.constructor.name} (${i.refId}) -> .filteredChanges:
`,I(i.filteredChanges)),s&&i.allFilteredChanges&&i.allFilteredChanges.operations.filter(E=>E).length>0&&(p+=`${e.constructor.name} (${i.refId}) -> .allFilteredChanges:
`,I(i.allFilteredChanges)),p}static debugChangesDeep(e,s="changes"){let i="";const c=e[g],d=c.root,p=new Map,I=[];let E=0;for(const[O,T]of Object.entries(d[s])){const L=d.changeTrees[O];if(!L)continue;let k=!1,D=[],C=L.parent?.[g];if(L===c)k=!0;else for(;C!==void 0;){if(D.push(C),C.ref===e){k=!0;break}C=C.parent?.[g]}k&&(I.push(L.refId),E+=Object.keys(T).length,p.set(L,D.reverse()))}i+=`---
`,i+=`root refId: ${c.refId}
`,i+=`Total instances: ${I.length} (refIds: ${I.join(", ")})
`,i+=`Total changes: ${E}
`,i+=`---
`;const b=new WeakSet;for(const[O,T]of p.entries()){T.forEach((M,ce)=>{b.has(M)||(i+=`${jt(ce)}${M.ref.constructor.name} (refId: ${M.refId})
`,b.add(M))});const L=O.indexedOperations,k=T.length,D=jt(k),C=k>0?`(${O.parentIndex}) `:"";i+=`${D}${C}${O.ref.constructor.name} (refId: ${O.refId}) - changes: ${Object.keys(L).length}
`;for(const M in L){const ce=L[M];i+=`${jt(k+1)}${n.OPERATION[ce]}: ${M}
`}}return`${i}`}}function Ze(l,e,s,i){var c=arguments.length,d=c<3?e:i,p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(l,e,s,i);else for(var I=l.length-1;I>=0;I--)(p=l[I])&&(d=(c<3?p(d):c>3?p(e,s,d):p(e,s))||d);return c>3&&d&&Object.defineProperty(e,s,d),d}typeof SuppressedError=="function"&&SuppressedError;class Oi{constructor(e){this.types=e,this.nextUniqueId=0,this.refCount={},this.changeTrees={},this.allChanges=mt(),this.allFilteredChanges=mt(),this.changes=mt(),this.filteredChanges=mt()}getNextUniqueId(){return this.nextUniqueId++}add(e){e.refId===void 0&&(e.refId=this.getNextUniqueId());const s=this.changeTrees[e.refId]===void 0;s&&(this.changeTrees[e.refId]=e);const i=this.refCount[e.refId];if(i===0){const c=e.allChanges.operations;let d=c.length;for(;d--;)e.indexedOperations[c[d]]=n.OPERATION.ADD,Ce(e.changes,d)}return this.refCount[e.refId]=(i||0)+1,s}remove(e){const s=this.refCount[e.refId]-1;return s<=0?(e.root=void 0,delete this.changeTrees[e.refId],this.removeChangeFromChangeSet("allChanges",e),this.removeChangeFromChangeSet("changes",e),e.filteredChanges&&(this.removeChangeFromChangeSet("allFilteredChanges",e),this.removeChangeFromChangeSet("filteredChanges",e)),this.refCount[e.refId]=0,e.forEachChild((i,c)=>{i.removeParent(e.ref)&&(i.parentChain===void 0||i.parentChain&&this.refCount[i.refId]>0?this.remove(i):i.parentChain&&this.moveNextToParent(i))})):(this.refCount[e.refId]=s,this.recursivelyMoveNextToParent(e)),s}recursivelyMoveNextToParent(e){this.moveNextToParent(e),e.forEachChild((s,i)=>this.recursivelyMoveNextToParent(s))}moveNextToParent(e){e.filteredChanges?(this.moveNextToParentInChangeTreeList("filteredChanges",e),this.moveNextToParentInChangeTreeList("allFilteredChanges",e)):(this.moveNextToParentInChangeTreeList("changes",e),this.moveNextToParentInChangeTreeList("allChanges",e))}moveNextToParentInChangeTreeList(e,s){const i=this[e],c=s[e].queueRootNode;if(!c)return;const d=s.parent;if(!d||!d[g])return;const p=d[g][e]?.queueRootNode;if(!p||p===c)return;const I=p.position;c.position>I||(c.prev?c.prev.next=c.next:i.next=c.next,c.next?c.next.prev=c.prev:i.tail=c.prev,c.prev=p,c.next=p.next,p.next?p.next.prev=c:i.tail=c,p.next=c,this.updatePositionsAfterMove(i,c,I+1))}enqueueChangeTree(e,s,i=e[s].queueRootNode){i||(e[s].queueRootNode=this.addToChangeTreeList(this[s],e))}addToChangeTreeList(e,s){const i={changeTree:s,next:void 0,prev:void 0,position:e.tail?e.tail.position+1:0};return e.next?(i.prev=e.tail,e.tail.next=i,e.tail=i):(e.next=i,e.tail=i),i}updatePositionsAfterRemoval(e,s){let i=e.next,c=0;for(;i;)c>=s&&(i.position=c),i=i.next,c++}updatePositionsAfterMove(e,s,i){let c=e.next,d=0;for(;c;)c.position=d,c=c.next,d++}removeChangeFromChangeSet(e,s){const i=this[e],c=s[e].queueRootNode;if(c&&c.changeTree===s){const d=c.position;return c.prev?c.prev.next=c.next:i.next=c.next,c.next?c.next.prev=c.prev:i.tail=c.prev,this.updatePositionsAfterRemoval(i,d),s[e].queueRootNode=void 0,!0}return!1}}class Ft{static{this.BUFFER_SIZE=typeof Buffer<"u"&&Buffer.poolSize||8*1024}constructor(e){this.sharedBuffer=Buffer.allocUnsafe(Ft.BUFFER_SIZE),this.context=Ie.cache(e.constructor),this.root=new Oi(this.context),this.setState(e)}setState(e){this.state=e,this.state[g].setRoot(this.root)}encode(e={offset:0},s,i=this.sharedBuffer,c="changes",d=c==="allChanges",p=e.offset){const I=s!==void 0,E=this.state[g];let b=this.root[c];for(;b=b.next;){const O=b.changeTree;if(I){if(!s.isChangeTreeVisible(O)){s.invisible.add(O);continue}s.invisible.delete(O)}const T=O[c],L=O.ref,k=T.operations.length;if(k===0)continue;const D=L.constructor,C=D[u],M=D[S],ce=D[Symbol.metadata];(I||e.offset>p||O!==E)&&(i[e.offset++]=255,Oe.number(i,O.refId,e));for(let fe=0;fe<k;fe++){const $e=T.operations[fe];if($e<0){i[e.offset++]=Math.abs($e)&255;continue}const De=d?n.OPERATION.ADD:O.indexedOperations[$e];$e===void 0||De===void 0||M&&!M(L,$e,s)||C(this,i,O,$e,De,e,d,I,ce)}}if(e.offset>i.byteLength){const O=Math.ceil(e.offset/(Buffer.poolSize??8192))*(Buffer.poolSize??8192);return console.warn(`@colyseus/schema buffer overflow. Encoded state is higher than default BUFFER_SIZE. Use the following to increase default BUFFER_SIZE:

    import { Encoder } from "@colyseus/schema";
    Encoder.BUFFER_SIZE = ${Math.round(O/1024)} * 1024; // ${Math.round(O/1024)} KB
`),i=Buffer.alloc(O,i),i===this.sharedBuffer&&(this.sharedBuffer=i),this.encode({offset:p},s,i,c,d)}else return i.subarray(0,e.offset)}encodeAll(e={offset:0},s=this.sharedBuffer){return this.encode(e,void 0,s,"allChanges",!0)}encodeAllView(e,s,i,c=this.sharedBuffer){const d=i.offset;return this.encode(i,e,c,"allFilteredChanges",!0,d),Buffer.concat([c.subarray(0,s),c.subarray(d,i.offset)])}debugChanges(e){let i=(typeof e=="string"?this.root[e]:e).next;for(;i;){const c=i.changeTree,d=c[e],p=c.ref.constructor[Symbol.metadata];console.log("->",{ref:c.ref.constructor.name,refId:c.refId,changes:Object.keys(d).length});for(const I in d){const E=d[I];console.log("  ->",{index:I,field:p?.[I],op:n.OPERATION[E]})}i=i.next}}encodeView(e,s,i,c=this.sharedBuffer){const d=i.offset;for(const[p,I]of e.changes){const E=this.root.changeTrees[p];if(E===void 0){e.changes.delete(p);continue}const b=Object.keys(I);if(b.length===0)continue;const T=E.ref.constructor,L=T[u],k=T[Symbol.metadata];c[i.offset++]=255,Oe.number(c,E.refId,i);for(let D=0,C=b.length;D<C;D++){const M=Number(b[D]),fe=E.ref[v](M)!==void 0&&I[M]||n.OPERATION.DELETE;L(this,c,E,M,fe,i,!1,!0,k)}}return e.changes.clear(),this.encode(i,e,c,"filteredChanges",!1,d),Buffer.concat([c.subarray(0,s),c.subarray(d,i.offset)])}discardChanges(){let e=this.root.changes.next;for(;e;)e.changeTree.endEncode("changes"),e=e.next;for(this.root.changes=mt(),e=this.root.filteredChanges.next;e;)e.changeTree.endEncode("filteredChanges"),e=e.next;this.root.filteredChanges=mt()}tryEncodeTypeId(e,s,i,c){const d=this.context.getTypeId(s),p=this.context.getTypeId(i);if(p===void 0){console.warn(`@colyseus/schema WARNING: Class "${i.name}" is not registered on TypeRegistry - Please either tag the class with @entity or define a @type() field.`);return}d!==p&&(e[c.offset++]=213,Oe.number(e,p,c))}get hasChanges(){return this.root.changes.next!==void 0||this.root.filteredChanges.next!==void 0}}function Er(l,e){if(e===-1||e>=l.length)return!1;const s=l.length-1;for(let i=e;i<s;i++)l[i]=l[i+1];return l.length=s,!0}class xr extends Error{constructor(e){super(e),this.name="DecodingWarning"}}class Ii{constructor(){this.refs=new Map,this.refIds=new WeakMap,this.refCount={},this.deletedRefs=new Set,this.callbacks={},this.nextUniqueId=0}getNextUniqueId(){return this.nextUniqueId++}addRef(e,s,i=!0){this.refs.set(e,s),this.refIds.set(s,e),i&&(this.refCount[e]=(this.refCount[e]||0)+1),this.deletedRefs.has(e)&&this.deletedRefs.delete(e)}removeRef(e){const s=this.refCount[e];if(s===void 0){try{throw new xr("trying to remove refId that doesn't exist: "+e)}catch(i){console.warn(i)}return}if(s===0){try{const i=this.refs.get(e);throw new xr(`trying to remove refId '${e}' with 0 refCount (${i.constructor.name}: ${JSON.stringify(i)})`)}catch(i){console.warn(i)}return}(this.refCount[e]=s-1)<=0&&this.deletedRefs.add(e)}clearRefs(){this.refs.clear(),this.deletedRefs.clear(),this.callbacks={},this.refCount={}}garbageCollectDeletedRefs(){this.deletedRefs.forEach(e=>{if(this.refCount[e]>0)return;const s=this.refs.get(e);if(s.constructor[Symbol.metadata]!==void 0){const i=s.constructor[Symbol.metadata];for(const c in i){const d=i[c].name,p=typeof s[d]=="object"&&this.refIds.get(s[d]);p&&!this.deletedRefs.has(p)&&this.removeRef(p)}}else typeof s[F]=="function"&&Array.from(s.values()).forEach(i=>{const c=this.refIds.get(i);this.deletedRefs.has(c)||this.removeRef(c)});this.refs.delete(e),delete this.refCount[e],delete this.callbacks[e]}),this.deletedRefs.clear()}addCallback(e,s,i){if(e===void 0){const c=typeof s=="number"?n.OPERATION[s]:s;throw new Error(`Can't addCallback on '${c}' (refId is undefined)`)}return this.callbacks[e]||(this.callbacks[e]={}),this.callbacks[e][s]||(this.callbacks[e][s]=[]),this.callbacks[e][s].push(i),()=>this.removeCallback(e,s,i)}removeCallback(e,s,i){const c=this.callbacks?.[e]?.[s]?.indexOf(i);c!==void 0&&c!==-1&&Er(this.callbacks[e][s],c)}}class En{constructor(e,s){this.currentRefId=0,this.setState(e),this.context=s||new Ie(e.constructor)}setState(e){this.state=e,this.root=new Ii,this.root.addRef(0,e)}decode(e,s={offset:0},i=this.state){const c=[],d=this.root,p=e.byteLength;let I=i.constructor[h];for(this.currentRefId=0;s.offset<p;){if(e[s.offset]==255){s.offset++,i[H]?.();const b=_e.number(e,s),O=d.refs.get(b);O?(i=O,I=i.constructor[h],this.currentRefId=b):(console.error(`"refId" not found: ${b}`,{previousRef:i,previousRefId:this.currentRefId}),console.warn("Please report this issue to the developers."),this.skipCurrentStructure(e,s,p));continue}if(I(this,e,s,i,c)===sr){console.warn("@colyseus/schema: definition mismatch"),this.skipCurrentStructure(e,s,p);continue}}return i[H]?.(),this.triggerChanges?.(c),d.garbageCollectDeletedRefs(),c}skipCurrentStructure(e,s,i){const c={offset:s.offset};for(;s.offset<i&&!(e[s.offset]===255&&(c.offset=s.offset+1,this.root.refs.has(_e.number(e,c))));)s.offset++}getInstanceType(e,s,i){let c;if(e[s.offset]===213){s.offset++;const d=_e.number(e,s);c=this.context.get(d)}return c||i}createInstanceOfType(e){return new e}removeChildRefs(e,s){const i=typeof e[F]!="string",c=this.root.refIds.get(e);e.forEach((d,p)=>{s.push({ref:e,refId:c,op:n.OPERATION.DELETE,field:p,value:void 0,previousValue:d}),i&&this.root.removeRef(this.root.refIds.get(d))})}}class yt extends ae{}Ze([Le("string")],yt.prototype,"name",void 0),Ze([Le("string")],yt.prototype,"type",void 0),Ze([Le("number")],yt.prototype,"referencedType",void 0);class wt extends ae{constructor(){super(...arguments),this.fields=new we}}Ze([Le("number")],wt.prototype,"id",void 0),Ze([Le("number")],wt.prototype,"extendsId",void 0),Ze([Le([yt])],wt.prototype,"fields",void 0);class bt extends ae{constructor(){super(...arguments),this.types=new we}static encode(e,s={offset:0}){const i=e.context,c=new bt,d=new Ft(c),p=i.schemas.get(e.state.constructor);p>0&&(c.rootType=p);const I=new Set,E={},b=T=>{if(T.extendsId===void 0||I.has(T.extendsId)){I.add(T.id),c.types.push(T);const L=E[T.id];L!==void 0&&(delete E[T.id],L.forEach(k=>b(k)))}else E[T.extendsId]===void 0&&(E[T.extendsId]=[]),E[T.extendsId].push(T)};i.schemas.forEach((T,L)=>{const k=new wt;k.id=Number(T);const D=Object.getPrototypeOf(L);D!==ae&&(k.extendsId=i.schemas.get(D));const C=L[Symbol.metadata];if(C!==D[Symbol.metadata])for(const M in C){const ce=Number(M),fe=C[ce].name;if(!Object.prototype.hasOwnProperty.call(C,fe))continue;const $e=new yt;$e.name=fe;let De;const Xe=C[ce];if(typeof Xe.type=="string")De=Xe.type;else{let Ut;ae.is(Xe.type)?(De="ref",Ut=Xe.type):(De=Object.keys(Xe.type)[0],typeof Xe.type[De]=="string"?De+=":"+Xe.type[De]:Ut=Xe.type[De]),$e.referencedType=Ut?i.getTypeId(Ut):-1}$e.type=De,k.fields.push($e)}b(k)});for(const T in E)E[T].forEach(L=>c.types.push(L));const O=d.encodeAll(s);return Buffer.from(O,0,s.offset)}static decode(e,s){const i=new bt;new En(i).decode(e,s);const d=new Ie;i.types.forEach(E=>{const b=d.get(E.extendsId)??ae,O=class extends b{};Ie.register(O),d.add(O,E.id)},{});const p=(E,b,O)=>{b.fields.forEach((T,L)=>{const k=O+L;if(T.referencedType!==void 0){let D=T.type,C=d.get(T.referencedType);if(!C){const M=T.type.split(":");D=M[0],C=M[1]}D==="ref"?ye.addField(E,k,T.name,C):ye.addField(E,k,T.name,{[D]:C})}else ye.addField(E,k,T.name,T.type)})};i.types.forEach(E=>{const b=d.get(E.id),O=ye.initialize(b),T=[];let L=E;do T.push(L),L=i.types.find(D=>D.id===L.extendsId);while(L);let k=0;T.reverse().forEach(D=>{p(O,D,k),k+=D.fields.length})});const I=new(d.get(i.rootType||0));return new En(I,d)}}Ze([Le([wt])],bt.prototype,"types",void 0),Ze([Le("number")],bt.prototype,"rootType",void 0);function vi(l){const e=l.root,s=e.callbacks,i=new WeakMap;let c;l.triggerChanges=function(I){const E=new Set;for(let b=0,O=I.length;b<O;b++){const T=I[b],L=T.refId,k=T.ref,D=s[L];if(D){if((T.op&n.OPERATION.DELETE)===n.OPERATION.DELETE&&T.previousValue instanceof ae){const C=s[e.refIds.get(T.previousValue)]?.[n.OPERATION.DELETE];for(let M=C?.length-1;M>=0;M--)C[M]()}if(k instanceof ae){if(!E.has(L)){const C=D?.[n.OPERATION.REPLACE];for(let M=C?.length-1;M>=0;M--)C[M]()}if(D.hasOwnProperty(T.field)){const C=D[T.field];for(let M=C?.length-1;M>=0;M--)C[M](T.value,T.previousValue)}}else{if((T.op&n.OPERATION.DELETE)===n.OPERATION.DELETE){if(T.previousValue!==void 0){const C=D[n.OPERATION.DELETE];for(let M=C?.length-1;M>=0;M--)C[M](T.previousValue,T.dynamicIndex??T.field)}if((T.op&n.OPERATION.ADD)===n.OPERATION.ADD){const C=D[n.OPERATION.ADD];for(let M=C?.length-1;M>=0;M--)C[M](T.value,T.dynamicIndex??T.field)}}else if((T.op&n.OPERATION.ADD)===n.OPERATION.ADD&&T.previousValue!==T.value){const C=D[n.OPERATION.ADD];for(let M=C?.length-1;M>=0;M--)C[M](T.value,T.dynamicIndex??T.field)}if(T.value!==T.previousValue&&(T.value!==void 0||T.previousValue!==void 0)){const C=D[n.OPERATION.REPLACE];for(let M=C?.length-1;M>=0;M--)C[M](T.value,T.dynamicIndex??T.field)}}E.add(L)}}};function d(I,E){let b=E.instance?.constructor[Symbol.metadata]||I,O=E.instance&&typeof E.instance.forEach=="function"||I&&typeof I[Symbol.metadata]>"u";if(b&&!O){const T=function(L,k,D,C){return C&&E.instance[k]!==void 0&&!i.has(c)&&D(E.instance[k],void 0),e.addCallback(e.refIds.get(L),k,D)};return new Proxy({listen:function(k,D,C=!0){if(E.instance)return T(E.instance,k,D,C);{let M=()=>{};return E.onInstanceAvailable((ce,fe)=>{M=T(ce,k,D,C&&fe&&!i.has(c))}),()=>M()}},onChange:function(k){return e.addCallback(e.refIds.get(E.instance),n.OPERATION.REPLACE,k)},bindTo:function(k,D){return D||(D=Object.keys(b).map(C=>b[C].name)),e.addCallback(e.refIds.get(E.instance),n.OPERATION.REPLACE,()=>{D.forEach(C=>k[C]=E.instance[C])})}},{get(L,k){const D=b[b[k]];if(D){const C=E.instance?.[k],M=ce=>{const fe=p(E.instance).listen(k,($e,De)=>{ce($e,!1),fe?.()},!1);e.refIds.get(C)!==void 0&&ce(C,!0)};return d(D.type,{instance:e.refIds.get(C)&&C,parentInstance:E.instance,onInstanceAvailable:M})}else return L[k]},has(L,k){return b[k]!==void 0},set(L,k,D){throw new Error("not allowed")},deleteProperty(L,k){throw new Error("not allowed")}})}else{const T=function(D,C,M){return M&&D.forEach((ce,fe)=>C(ce,fe)),e.addCallback(e.refIds.get(D),n.OPERATION.ADD,(ce,fe)=>{i.set(C,!0),c=C,C(ce,fe),i.delete(C),c=void 0})},L=function(D,C){return e.addCallback(e.refIds.get(D),n.OPERATION.DELETE,C)},k=function(D,C){return e.addCallback(e.refIds.get(D),n.OPERATION.REPLACE,C)};return new Proxy({onAdd:function(D,C=!0){if(E.instance)return T(E.instance,D,C&&!i.has(c));if(E.onInstanceAvailable){let M=()=>{};return E.onInstanceAvailable((ce,fe)=>{M=T(ce,D,C&&fe&&!i.has(c))}),()=>M()}},onRemove:function(D){if(E.instance)return L(E.instance,D);if(E.onInstanceAvailable){let C=()=>{};return E.onInstanceAvailable(M=>{C=L(M,D)}),()=>C()}},onChange:function(D){if(E.instance)return k(E.instance,D);if(E.onInstanceAvailable){let C=()=>{};return E.onInstanceAvailable(M=>{C=k(M,D)}),()=>C()}}},{get(D,C){if(!D[C])throw new Error(`Can't access '${C}' through callback proxy. access the instance directly.`);return D[C]},has(D,C){return D[C]!==void 0},set(D,C,M){throw new Error("not allowed")},deleteProperty(D,C){throw new Error("not allowed")}})}}function p(I){return d(void 0,{instance:I})}return p}function Si(l,e){l.triggerChanges=e}class Ti{constructor(e=!1){this.iterable=e,this.visible=new WeakSet,this.invisible=new WeakSet,this.changes=new Map,e&&(this.items=[])}add(e,s=qe,i=!0){const c=e?.[g],d=c.parent;if(c){if(!d&&c.refId!==0)throw new Error(`Cannot add a detached instance to the StateView. Make sure to assign the "${c.ref.constructor.name}" instance to the state before calling view.add()`)}else return console.warn("StateView#add(), invalid object:",e),!1;const p=e.constructor[Symbol.metadata];this.visible.add(c),this.iterable&&i&&this.items.push(e),i&&d&&this.addParentOf(c,s);let I=this.changes.get(c.refId);I===void 0&&(I={},this.changes.set(c.refId,I));let E=!1;if(c.forEachChild((b,O)=>{p&&p[O].tag!==void 0&&p[O].tag!==s||this.add(b.ref,s,!1)&&(E=!0)}),s!==qe){this.tags||(this.tags=new WeakMap);let b;this.tags.has(c)?b=this.tags.get(c):(b=new Set,this.tags.set(c,b)),b.add(s),p?.[te]?.[s]?.forEach(O=>{c.getChange(O)!==n.OPERATION.DELETE&&(I[O]=n.OPERATION.ADD)})}else if(!c.isNew||E){const b=c.filteredChanges!==void 0?c.allFilteredChanges:c.allChanges,O=this.invisible.has(c);for(let T=0,L=b.operations.length;T<L;T++){const k=b.operations[T];if(k===void 0)continue;const D=c.indexedOperations[k]??n.OPERATION.ADD,C=p?.[k].tag;D!==n.OPERATION.DELETE&&(O||C===void 0||C===s)&&(I[k]=D,E=!0)}}return E}addParentOf(e,s){const i=e.parent[g],c=e.parentIndex;if(!this.visible.has(i)){this.visible.add(i);const d=i.parent?.[g];d&&d.filteredChanges!==void 0&&this.addParentOf(i,s)}if(i.getChange(c)!==n.OPERATION.DELETE){let d=this.changes.get(i.refId);d===void 0&&(d={},this.changes.set(i.refId,d)),this.tags||(this.tags=new WeakMap);let p;this.tags.has(i)?p=this.tags.get(i):(p=new Set,this.tags.set(i,p)),p.add(s),d[c]=n.OPERATION.ADD}}remove(e,s=qe,i=!1){const c=e[g];if(!c)return console.warn("StateView#remove(), invalid object:",e),this;this.visible.delete(c),this.iterable&&!i&&Er(this.items,this.items.indexOf(e));const p=c.ref.constructor[Symbol.metadata];let I=this.changes.get(c.refId);if(I===void 0&&(I={},this.changes.set(c.refId,I)),s===qe){const E=c.parent;if(E&&!ye.isValidInstance(E)&&c.isFiltered){const b=E[g];let O=this.changes.get(b.refId);O===void 0?(O={},this.changes.set(b.refId,O)):O[c.parentIndex]===n.OPERATION.ADD&&this.changes.delete(c.refId),O[c.parentIndex]=n.OPERATION.DELETE,this._recursiveDeleteVisibleChangeTree(c)}else p?.[ee]?.forEach(b=>I[b]=n.OPERATION.DELETE)}else p?.[te][s].forEach(E=>I[E]=n.OPERATION.DELETE);if(this.tags&&this.tags.has(c)){const E=this.tags.get(c);s===void 0?this.tags.delete(c):(E.delete(s),E.size===0&&this.tags.delete(c))}return this}has(e){return this.visible.has(e[g])}hasTag(e,s=qe){return this.tags?.get(e[g])?.has(s)??!1}clear(){if(!this.iterable)throw new Error("StateView#clear() is only available for iterable StateView's. Use StateView(iterable: true) constructor.");for(let e=0,s=this.items.length;e<s;e++)this.remove(this.items[e],qe,!0);this.items.length=0}isChangeTreeVisible(e){let s=this.visible.has(e);return!s&&e.isVisibilitySharedWithParent&&this.visible.has(e.parent[g])&&(this.visible.add(e),s=!0),s}_recursiveDeleteVisibleChangeTree(e){e.forEachChild(s=>{this.visible.delete(s),this._recursiveDeleteVisibleChangeTree(s)})}}Fe("map",{constructor:Pe}),Fe("array",{constructor:we}),Fe("set",{constructor:at}),Fe("collection",{constructor:ot}),n.$changes=g,n.$childType=F,n.$decoder=h,n.$deleteByIndex=$,n.$encoder=u,n.$filter=S,n.$getByIndex=v,n.$track=f,n.ArraySchema=we,n.ChangeTree=pt,n.CollectionSchema=ot,n.Decoder=En,n.Encoder=Ft,n.MapSchema=Pe,n.Metadata=ye,n.Reflection=bt,n.ReflectionField=yt,n.ReflectionType=wt,n.Schema=ae,n.SetSchema=at,n.StateView=Ti,n.TypeContext=Ie,n.decode=_e,n.decodeKeyValueOperation=Lt,n.decodeSchemaOperation=ir,n.defineCustomTypes=hi,n.defineTypes=Ei,n.deprecated=bi,n.dumpChanges=xi,n.encode=Oe,n.encodeArray=rr,n.encodeKeyValueOperation=Mt,n.encodeSchemaOperation=nr,n.entity=wi,n.getDecoderStateCallbacks=vi,n.getRawChangesCallback=Si,n.registerType=Fe,n.schema=yr,n.type=Le,n.view=mr})})(Cn,Cn.exports);var Bn=Cn.exports,Sr=cn,ct=Bn;class Yi{constructor(t){this.events=t,this.isOpen=!1,this.lengthPrefixBuffer=new Uint8Array(9)}connect(t,n={}){const o=n.fingerprint&&{serverCertificateHashes:[{algorithm:"sha-256",value:new Uint8Array(n.fingerprint).buffer}]}||void 0;this.wt=new WebTransport(t,o),this.wt.ready.then(a=>{console.log("WebTransport ready!",a),this.isOpen=!0,this.unreliableReader=this.wt.datagrams.readable.getReader(),this.unreliableWriter=this.wt.datagrams.writable.getWriter(),this.wt.incomingBidirectionalStreams.getReader().read().then(u=>{this.reader=u.value.readable.getReader(),this.writer=u.value.writable.getWriter(),this.sendSeatReservation(n.room.roomId,n.sessionId,n.reconnectionToken),this.readIncomingData(),this.readIncomingUnreliableData()}).catch(u=>{console.error("failed to read incoming stream",u),console.error("TODO: close the connection")})}).catch(a=>{console.log("WebTransport not ready!",a),this._close()}),this.wt.closed.then(a=>{console.log("WebTransport closed w/ success",a),this.events.onclose({code:a.closeCode,reason:a.reason})}).catch(a=>{console.log("WebTransport closed w/ error",a),this.events.onerror(a),this.events.onclose({code:a.closeCode,reason:a.reason})}).finally(()=>{this._close()})}send(t){const n=ct.encode.number(this.lengthPrefixBuffer,t.length,{offset:0}),o=new Uint8Array(n+t.length);o.set(this.lengthPrefixBuffer.subarray(0,n),0),o.set(t,n),this.writer.write(o)}sendUnreliable(t){const n=ct.encode.number(this.lengthPrefixBuffer,t.length,{offset:0}),o=new Uint8Array(n+t.length);o.set(this.lengthPrefixBuffer.subarray(0,n),0),o.set(t,n),this.unreliableWriter.write(o)}close(t,n){try{this.wt.close({closeCode:t,reason:n})}catch(o){console.error(o)}}readIncomingData(){return Sr.__awaiter(this,void 0,void 0,function*(){let t;for(;this.isOpen;){try{t=yield this.reader.read();const n=t.value,o={offset:0};do{const a=ct.decode.number(n,o);this.events.onmessage({data:n.subarray(o.offset,o.offset+a)}),o.offset+=a}while(o.offset<n.length)}catch(n){n.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",n);break}if(t.done)break}})}readIncomingUnreliableData(){return Sr.__awaiter(this,void 0,void 0,function*(){let t;for(;this.isOpen;){try{t=yield this.unreliableReader.read();const n=t.value,o={offset:0};do{const a=ct.decode.number(n,o);this.events.onmessage({data:n.subarray(o.offset,o.offset+a)}),o.offset+=a}while(o.offset<n.length)}catch(n){n.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",n);break}if(t.done)break}})}sendSeatReservation(t,n,o){const a={offset:0},f=[];ct.encode.string(f,t,a),ct.encode.string(f,n,a),o&&ct.encode.string(f,o,a),this.writer.write(new Uint8Array(f).buffer)}_close(){this.isOpen=!1}}Ps.H3TransportTransport=Yi;var Ds={},Zi=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},Xi=Zi;const On=globalThis.WebSocket||Xi;let Qi=class{constructor(t){this.events=t}send(t){this.ws.send(t)}sendUnreliable(t){console.warn("colyseus.js: The WebSocket transport does not support unreliable messages")}connect(t,n){try{this.ws=new On(t,{headers:n,protocols:this.protocols})}catch{this.ws=new On(t,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(t,n){this.ws.close(t,n)}get isOpen(){return this.ws.readyState===On.OPEN}};Ds.WebSocketTransport=Qi;var eo=Ps,to=Ds;let no=class{constructor(t){switch(this.events={},t){case"h3":this.transport=new eo.H3TransportTransport(this.events);break;default:this.transport=new to.WebSocketTransport(this.events);break}}connect(t,n){this.transport.connect.call(this.transport,t,n)}send(t){this.transport.send(t)}sendUnreliable(t){this.transport.sendUnreliable(t)}close(t,n){this.transport.close(t,n)}get isOpen(){return this.transport.isOpen}};Rs.Connection=no;var jn={};(function(r){r.Protocol=void 0,function(t){t[t.HANDSHAKE=9]="HANDSHAKE",t[t.JOIN_ROOM=10]="JOIN_ROOM",t[t.ERROR=11]="ERROR",t[t.LEAVE_ROOM=12]="LEAVE_ROOM",t[t.ROOM_DATA=13]="ROOM_DATA",t[t.ROOM_STATE=14]="ROOM_STATE",t[t.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",t[t.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",t[t.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(r.Protocol||(r.Protocol={})),r.ErrorCode=void 0,function(t){t[t.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",t[t.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",t[t.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",t[t.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",t[t.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",t[t.AUTH_FAILED=4215]="AUTH_FAILED",t[t.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(r.ErrorCode||(r.ErrorCode={}))})(jn);var fn={};const Ns={};function ro(r,t){Ns[r]=t}function so(r){const t=Ns[r];if(!t)throw new Error("missing serializer: "+r);return t}fn.getSerializer=so;fn.registerSerializer=ro;var Fn={};const io=()=>({emit(r,...t){let n=this.events[r]||[];for(let o=0,a=n.length;o<a;o++)n[o](...t)},events:{},on(r,t){var n;return!((n=this.events[r])===null||n===void 0)&&n.push(t)||(this.events[r]=[t]),()=>{var o;this.events[r]=(o=this.events[r])===null||o===void 0?void 0:o.filter(a=>t!==a)}}});Fn.createNanoEvents=io;var Un={};class ks{constructor(){this.handlers=[]}register(t,n=!1){return this.handlers.push(t),this}invoke(...t){this.handlers.forEach(n=>n.apply(this,t))}invokeAsync(...t){return Promise.all(this.handlers.map(n=>n.apply(this,t)))}remove(t){const n=this.handlers.indexOf(t);this.handlers[n]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}function oo(){const r=new ks;function t(n){return r.register(n,this===null)}return t.once=n=>{const o=function(...a){n.apply(this,a),r.remove(o)};r.register(o)},t.remove=n=>r.remove(n),t.invoke=(...n)=>r.invoke(...n),t.invokeAsync=(...n)=>r.invokeAsync(...n),t.clear=()=>r.clear(),t}Un.EventEmitter=ks;Un.createSignal=oo;var ln={},Wt=Bn;function ao(r){try{return Wt.getDecoderStateCallbacks(r.serializer.decoder)}catch{return}}let co=class{setState(t,n){this.decoder.decode(t,n)}getState(){return this.state}patch(t,n){return this.decoder.decode(t,n)}teardown(){this.decoder.root.clearRefs()}handshake(t,n){this.state?(Wt.Reflection.decode(t,n),this.decoder=new Wt.Decoder(this.state)):(this.decoder=Wt.Reflection.decode(t,n),this.state=this.decoder.state)}};ln.SchemaSerializer=co;ln.getStateCallbacks=ao;var $n;try{$n=new TextDecoder}catch{}var N,Ve,m=0,re={},G,et,ke=0,Ue=0,pe,Ke,xe=[],W,Tr={useRecords:!1,mapsAsObjects:!0};class Ms{}const Vn=new Ms;Vn.name="MessagePack 0xC1";var tt=!1,Ls=2,fo;try{new Function("")}catch{Ls=1/0}class nt{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(N)return zs(()=>(rn(),this?this.unpack(t,n):nt.prototype.unpack.call(Tr,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof Buffer<"u"?Buffer.from(t):new Uint8Array(t)),typeof n=="object"?(Ve=n.end||t.length,m=n.start||0):(m=0,Ve=n>-1?n:t.length),Ue=0,et=null,pe=null,N=t;try{W=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(o){throw N=null,t instanceof Uint8Array?o:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof nt){if(re=this,this.structures)return G=this.structures,Vt(n);(!G||G.length>0)&&(G=[])}else re=Tr,(!G||G.length>0)&&(G=[]);return Vt(n)}unpackMultiple(t,n){let o,a=0;try{tt=!0;let f=t.length,u=this?this.unpack(t,f):dn.unpack(t,f);if(n){if(n(u,a,m)===!1)return;for(;m<f;)if(a=m,n(Vt(),a,m)===!1)return}else{for(o=[u];m<f;)a=m,o.push(Vt());return o}}catch(f){throw f.lastPosition=a,f.values=o,f}finally{tt=!1,rn()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(o=>o.slice(0)));for(let o=0,a=t.length;o<a;o++){let f=t[o];f&&(f.isShared=!0,o>=32&&(f.highByte=o-32>>5))}t.sharedLength=t.length;for(let o in n||[])if(o>=0){let a=t[o],f=n[o];f&&(a&&((t.restoreStructures||(t.restoreStructures=[]))[o]=a),t[o]=f)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function Vt(r){try{if(!re.trusted&&!tt){let n=G.sharedLength||0;n<G.length&&(G.length=n)}let t;if(re.randomAccessStructure&&N[m]<64&&N[m]>=32&&fo||(t=le()),pe&&(m=pe.postBundlePosition,pe=null),tt&&(G.restoreStructures=null),m==Ve)G&&G.restoreStructures&&Ar(),G=null,N=null,Ke&&(Ke=null);else{if(m>Ve)throw new Error("Unexpected end of MessagePack data");if(!tt){let n;try{n=JSON.stringify(t,(o,a)=>typeof a=="bigint"?`${a}n`:a).slice(0,100)}catch(o){n="(JSON view not available "+o+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw G&&G.restoreStructures&&Ar(),rn(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||m>Ve)&&(t.incomplete=!0),t}}function Ar(){for(let r in G.restoreStructures)G[r]=G.restoreStructures[r];G.restoreStructures=null}function le(){let r=N[m++];if(r<160)if(r<128){if(r<64)return r;{let t=G[r&63]||re.getStructures&&Bs()[r&63];return t?(t.read||(t.read=zn(t,r&63)),t.read()):r}}else if(r<144)if(r-=128,re.mapsAsObjects){let t={};for(let n=0;n<r;n++){let o=Fs();o==="__proto__"&&(o="__proto_"),t[o]=le()}return t}else{let t=new Map;for(let n=0;n<r;n++)t.set(le(),le());return t}else{r-=144;let t=new Array(r);for(let n=0;n<r;n++)t[n]=le();return re.freezeData?Object.freeze(t):t}else if(r<192){let t=r-160;if(Ue>=m)return et.slice(m-ke,(m+=t)-ke);if(Ue==0&&Ve<140){let n=t<16?Hn(t):js(t);if(n!=null)return n}return Rn(t)}else{let t;switch(r){case 192:return null;case 193:return pe?(t=le(),t>0?pe[1].slice(pe.position1,pe.position1+=t):pe[0].slice(pe.position0,pe.position0-=t)):Vn;case 194:return!1;case 195:return!0;case 196:if(t=N[m++],t===void 0)throw new Error("Unexpected end of buffer");return In(t);case 197:return t=W.getUint16(m),m+=2,In(t);case 198:return t=W.getUint32(m),m+=4,In(t);case 199:return ft(N[m++]);case 200:return t=W.getUint16(m),m+=2,ft(t);case 201:return t=W.getUint32(m),m+=4,ft(t);case 202:if(t=W.getFloat32(m),re.useFloat32>2){let n=un[(N[m]&127)<<1|N[m+1]>>7];return m+=4,(n*t+(t>0?.5:-.5)>>0)/n}return m+=4,t;case 203:return t=W.getFloat64(m),m+=8,t;case 204:return N[m++];case 205:return t=W.getUint16(m),m+=2,t;case 206:return t=W.getUint32(m),m+=4,t;case 207:return re.int64AsType==="number"?(t=W.getUint32(m)*4294967296,t+=W.getUint32(m+4)):re.int64AsType==="string"?t=W.getBigUint64(m).toString():re.int64AsType==="auto"?(t=W.getBigUint64(m),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=W.getBigUint64(m),m+=8,t;case 208:return W.getInt8(m++);case 209:return t=W.getInt16(m),m+=2,t;case 210:return t=W.getInt32(m),m+=4,t;case 211:return re.int64AsType==="number"?(t=W.getInt32(m)*4294967296,t+=W.getUint32(m+4)):re.int64AsType==="string"?t=W.getBigInt64(m).toString():re.int64AsType==="auto"?(t=W.getBigInt64(m),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=W.getBigInt64(m),m+=8,t;case 212:if(t=N[m++],t==114)return Dr(N[m++]&63);{let n=xe[t];if(n)return n.read?(m++,n.read(le())):n.noBuffer?(m++,n()):n(N.subarray(m,++m));throw new Error("Unknown extension "+t)}case 213:return t=N[m],t==114?(m++,Dr(N[m++]&63,N[m++])):ft(2);case 214:return ft(4);case 215:return ft(8);case 216:return ft(16);case 217:return t=N[m++],Ue>=m?et.slice(m-ke,(m+=t)-ke):uo(t);case 218:return t=W.getUint16(m),m+=2,Ue>=m?et.slice(m-ke,(m+=t)-ke):ho(t);case 219:return t=W.getUint32(m),m+=4,Ue>=m?et.slice(m-ke,(m+=t)-ke):go(t);case 220:return t=W.getUint16(m),m+=2,Cr(t);case 221:return t=W.getUint32(m),m+=4,Cr(t);case 222:return t=W.getUint16(m),m+=2,$r(t);case 223:return t=W.getUint32(m),m+=4,$r(t);default:if(r>=224)return r-256;if(r===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+r)}}}const lo=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function zn(r,t){function n(){if(n.count++>Ls){let a=r.read=new Function("r","return function(){return "+(re.freezeData?"Object.freeze":"")+"({"+r.map(f=>f==="__proto__"?"__proto_:r()":lo.test(f)?f+":r()":"["+JSON.stringify(f)+"]:r()").join(",")+"})}")(le);return r.highByte===0&&(r.read=_r(t,r.read)),a()}let o={};for(let a=0,f=r.length;a<f;a++){let u=r[a];u==="__proto__"&&(u="__proto_"),o[u]=le()}return re.freezeData?Object.freeze(o):o}return n.count=0,r.highByte===0?_r(t,n):n}const _r=(r,t)=>function(){let n=N[m++];if(n===0)return t();let o=r<32?-(r+(n<<5)):r+(n<<5),a=G[o]||Bs()[o];if(!a)throw new Error("Record id is not defined for "+o);return a.read||(a.read=zn(a,r)),a.read()};function Bs(){let r=zs(()=>(N=null,re.getStructures()));return G=re._mergeStructures(r,G)}var Rn=Dt,uo=Dt,ho=Dt,go=Dt;let mo=!1;function Dt(r){let t;if(r<16&&(t=Hn(r)))return t;if(r>64&&$n)return $n.decode(N.subarray(m,m+=r));const n=m+r,o=[];for(t="";m<n;){const a=N[m++];if(!(a&128))o.push(a);else if((a&224)===192){const f=N[m++]&63;o.push((a&31)<<6|f)}else if((a&240)===224){const f=N[m++]&63,u=N[m++]&63;o.push((a&31)<<12|f<<6|u)}else if((a&248)===240){const f=N[m++]&63,u=N[m++]&63,h=N[m++]&63;let S=(a&7)<<18|f<<12|u<<6|h;S>65535&&(S-=65536,o.push(S>>>10&1023|55296),S=56320|S&1023),o.push(S)}else o.push(a);o.length>=4096&&(t+=me.apply(String,o),o.length=0)}return o.length>0&&(t+=me.apply(String,o)),t}function Cr(r){let t=new Array(r);for(let n=0;n<r;n++)t[n]=le();return re.freezeData?Object.freeze(t):t}function $r(r){if(re.mapsAsObjects){let t={};for(let n=0;n<r;n++){let o=Fs();o==="__proto__"&&(o="__proto_"),t[o]=le()}return t}else{let t=new Map;for(let n=0;n<r;n++)t.set(le(),le());return t}}var me=String.fromCharCode;function js(r){let t=m,n=new Array(r);for(let o=0;o<r;o++){const a=N[m++];if((a&128)>0){m=t;return}n[o]=a}return me.apply(String,n)}function Hn(r){if(r<4)if(r<2){if(r===0)return"";{let t=N[m++];if((t&128)>1){m-=1;return}return me(t)}}else{let t=N[m++],n=N[m++];if((t&128)>0||(n&128)>0){m-=2;return}if(r<3)return me(t,n);let o=N[m++];if((o&128)>0){m-=3;return}return me(t,n,o)}else{let t=N[m++],n=N[m++],o=N[m++],a=N[m++];if((t&128)>0||(n&128)>0||(o&128)>0||(a&128)>0){m-=4;return}if(r<6){if(r===4)return me(t,n,o,a);{let f=N[m++];if((f&128)>0){m-=5;return}return me(t,n,o,a,f)}}else if(r<8){let f=N[m++],u=N[m++];if((f&128)>0||(u&128)>0){m-=6;return}if(r<7)return me(t,n,o,a,f,u);let h=N[m++];if((h&128)>0){m-=7;return}return me(t,n,o,a,f,u,h)}else{let f=N[m++],u=N[m++],h=N[m++],S=N[m++];if((f&128)>0||(u&128)>0||(h&128)>0||(S&128)>0){m-=8;return}if(r<10){if(r===8)return me(t,n,o,a,f,u,h,S);{let v=N[m++];if((v&128)>0){m-=9;return}return me(t,n,o,a,f,u,h,S,v)}}else if(r<12){let v=N[m++],$=N[m++];if((v&128)>0||($&128)>0){m-=10;return}if(r<11)return me(t,n,o,a,f,u,h,S,v,$);let g=N[m++];if((g&128)>0){m-=11;return}return me(t,n,o,a,f,u,h,S,v,$,g)}else{let v=N[m++],$=N[m++],g=N[m++],F=N[m++];if((v&128)>0||($&128)>0||(g&128)>0||(F&128)>0){m-=12;return}if(r<14){if(r===12)return me(t,n,o,a,f,u,h,S,v,$,g,F);{let B=N[m++];if((B&128)>0){m-=13;return}return me(t,n,o,a,f,u,h,S,v,$,g,F,B)}}else{let B=N[m++],H=N[m++];if((B&128)>0||(H&128)>0){m-=14;return}if(r<15)return me(t,n,o,a,f,u,h,S,v,$,g,F,B,H);let U=N[m++];if((U&128)>0){m-=15;return}return me(t,n,o,a,f,u,h,S,v,$,g,F,B,H,U)}}}}}function Rr(){let r=N[m++],t;if(r<192)t=r-160;else switch(r){case 217:t=N[m++];break;case 218:t=W.getUint16(m),m+=2;break;case 219:t=W.getUint32(m),m+=4;break;default:throw new Error("Expected string")}return Dt(t)}function In(r){return re.copyBuffers?Uint8Array.prototype.slice.call(N,m,m+=r):N.subarray(m,m+=r)}function ft(r){let t=N[m++];if(xe[t]){let n;return xe[t](N.subarray(m,n=m+=r),o=>{m=o;try{return le()}finally{m=n}})}else throw new Error("Unknown extension type "+t)}var Pr=new Array(4096);function Fs(){let r=N[m++];if(r>=160&&r<192){if(r=r-160,Ue>=m)return et.slice(m-ke,(m+=r)-ke);if(!(Ue==0&&Ve<180))return Rn(r)}else return m--,Us(le());let t=(r<<5^(r>1?W.getUint16(m):r>0?N[m]:0))&4095,n=Pr[t],o=m,a=m+r-3,f,u=0;if(n&&n.bytes==r){for(;o<a;){if(f=W.getUint32(o),f!=n[u++]){o=1879048192;break}o+=4}for(a+=3;o<a;)if(f=N[o++],f!=n[u++]){o=1879048192;break}if(o===a)return m=o,n.string;a-=3,o=m}for(n=[],Pr[t]=n,n.bytes=r;o<a;)f=W.getUint32(o),n.push(f),o+=4;for(a+=3;o<a;)f=N[o++],n.push(f);let h=r<16?Hn(r):js(r);return h!=null?n.string=h:n.string=Rn(r)}function Us(r){if(typeof r=="string")return r;if(typeof r=="number"||typeof r=="boolean"||typeof r=="bigint")return r.toString();if(r==null)return r+"";if(re.allowArraysInMapKeys&&Array.isArray(r)&&r.flat().every(t=>["string","number","boolean","bigint"].includes(typeof t)))return r.flat().toString();throw new Error(`Invalid property type for record: ${typeof r}`)}const Dr=(r,t)=>{let n=le().map(Us),o=r;t!==void 0&&(r=r<32?-((t<<5)+r):(t<<5)+r,n.highByte=t);let a=G[r];return a&&(a.isShared||tt)&&((G.restoreStructures||(G.restoreStructures=[]))[r]=a),G[r]=n,n.read=zn(n,o),n.read()};xe[0]=()=>{};xe[0].noBuffer=!0;xe[66]=r=>{let t=r.length,n=BigInt(r[0]&128?r[0]-256:r[0]);for(let o=1;o<t;o++)n<<=BigInt(8),n+=BigInt(r[o]);return n};let po={Error,TypeError,ReferenceError};xe[101]=()=>{let r=le();return(po[r[0]]||Error)(r[1],{cause:r[2]})};xe[105]=r=>{if(re.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=W.getUint32(m-4);Ke||(Ke=new Map);let n=N[m],o;n>=144&&n<160||n==220||n==221?o=[]:o={};let a={target:o};Ke.set(t,a);let f=le();return a.used?Object.assign(o,f):(a.target=f,f)};xe[112]=r=>{if(re.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=W.getUint32(m-4),n=Ke.get(t);return n.used=!0,n.target};xe[115]=()=>new Set(le());const Vs=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(r=>r+"Array");let yo=typeof globalThis=="object"?globalThis:window;xe[116]=r=>{let t=r[0],n=Vs[t];if(!n){if(t===16){let o=new ArrayBuffer(r.length-1);return new Uint8Array(o).set(r.subarray(1)),o}throw new Error("Could not find typed array for code "+t)}return new yo[n](Uint8Array.prototype.slice.call(r,1).buffer)};xe[120]=()=>{let r=le();return new RegExp(r[0],r[1])};const wo=[];xe[98]=r=>{let t=(r[0]<<24)+(r[1]<<16)+(r[2]<<8)+r[3],n=m;return m+=t-r.length,pe=wo,pe=[Rr(),Rr()],pe.position0=0,pe.position1=0,pe.postBundlePosition=m,m=n,le()};xe[255]=r=>r.length==4?new Date((r[0]*16777216+(r[1]<<16)+(r[2]<<8)+r[3])*1e3):r.length==8?new Date(((r[0]<<22)+(r[1]<<14)+(r[2]<<6)+(r[3]>>2))/1e6+((r[3]&3)*4294967296+r[4]*16777216+(r[5]<<16)+(r[6]<<8)+r[7])*1e3):r.length==12?new Date(((r[0]<<24)+(r[1]<<16)+(r[2]<<8)+r[3])/1e6+((r[4]&128?-281474976710656:0)+r[6]*1099511627776+r[7]*4294967296+r[8]*16777216+(r[9]<<16)+(r[10]<<8)+r[11])*1e3):new Date("invalid");function zs(r){let t=Ve,n=m,o=ke,a=Ue,f=et,u=Ke,h=pe,S=new Uint8Array(N.slice(0,Ve)),v=G,$=G.slice(0,G.length),g=re,F=tt,B=r();return Ve=t,m=n,ke=o,Ue=a,et=f,Ke=u,pe=h,N=S,tt=F,G=v,G.splice(0,G.length,...$),re=g,W=new DataView(N.buffer,N.byteOffset,N.byteLength),B}function rn(){N=null,Ke=null,G=null}function bo(r){r.unpack?xe[r.type]=r.unpack:xe[r.type]=r}const un=new Array(147);for(let r=0;r<256;r++)un[r]=+("1e"+Math.floor(45.15-r*.30103));const Eo=nt;var dn=new nt({useRecords:!1});const xo=dn.unpack,Oo=dn.unpackMultiple,Io=dn.unpack,Hs={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};let qs=new Float32Array(1),Nr=new Uint8Array(qs.buffer,0,4);function vo(r){qs[0]=r;let t=un[(Nr[3]&127)<<1|Nr[2]>>7];return(t*r+(r>0?.5:-.5)>>0)/t}let Jt;try{Jt=new TextEncoder}catch{}let sn,qn;const hn=typeof Buffer<"u",zt=hn?function(r){return Buffer.allocUnsafeSlow(r)}:Uint8Array,Ws=hn?Buffer:Uint8Array,kr=hn?4294967296:2144337920;let x,At,ne,y=0,ve,oe=null,So;const To=21760,Ao=/[\u0080-\uFFFF]/,xt=Symbol("record-id");class Nt extends nt{constructor(t){super(t),this.offset=0;let n,o,a,f,u=Ws.prototype.utf8Write?function(w,P){return x.utf8Write(w,P,x.byteLength-P)}:Jt&&Jt.encodeInto?function(w,P){return Jt.encodeInto(w,x.subarray(P)).written}:!1,h=this;t||(t={});let S=t&&t.sequential,v=t.structures||t.saveStructures,$=t.maxSharedStructures;if($==null&&($=v?32:0),$>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let g=t.maxOwnStructures;g==null&&(g=v?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let F=$>32||g+$>64,B=$+64,H=$+g+64;if(H>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let U=[],Y=0,X=0;this.pack=this.encode=function(w,P){if(x||(x=new zt(8192),ne=x.dataView||(x.dataView=new DataView(x.buffer,0,8192)),y=0),ve=x.length-10,ve-y<2048?(x=new zt(x.length),ne=x.dataView||(x.dataView=new DataView(x.buffer,0,x.length)),ve=x.length-10,y=0):y=y+7&2147483640,n=y,P&Ys&&(y+=P&255),f=h.structuredClone?new Map:null,h.bundleStrings&&typeof w!="string"?(oe=[],oe.size=1/0):oe=null,a=h.structures,a){a.uninitialized&&(a=h._mergeStructures(h.getStructures()));let A=a.sharedLength||0;if(A>$)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+a.sharedLength);if(!a.transitions){a.transitions=Object.create(null);for(let _=0;_<A;_++){let j=a[_];if(!j)continue;let z,V=a.transitions;for(let J=0,K=j.length;J<K;J++){let ie=j[J];z=V[ie],z||(z=V[ie]=Object.create(null)),V=z}V[xt]=_+64}this.lastNamedStructuresLength=A}S||(a.nextId=A+64)}o&&(o=!1);let R;try{h.randomAccessStructure&&w&&w.constructor&&w.constructor===Object?Q(w):q(w);let A=oe;if(oe&&Br(n,q,0),f&&f.idsToInsert){let _=f.idsToInsert.sort((J,K)=>J.offset>K.offset?1:-1),j=_.length,z=-1;for(;A&&j>0;){let J=_[--j].offset+n;J<A.stringsPosition+n&&z===-1&&(z=0),J>A.position+n?z>=0&&(z+=6):(z>=0&&(ne.setUint32(A.position+n,ne.getUint32(A.position+n)+z),z=-1),A=A.previous,j++)}z>=0&&A&&ne.setUint32(A.position+n,ne.getUint32(A.position+n)+z),y+=_.length*6,y>ve&&Ae(y),h.offset=y;let V=Co(x.subarray(n,y),_);return f=null,V}return h.offset=y,P&Ks?(x.start=n,x.end=y,x):x.subarray(n,y)}catch(A){throw R=A,A}finally{if(a&&(ee(),o&&h.saveStructures)){let A=a.sharedLength||0,_=x.subarray(n,y),j=Ro(a,h);if(!R)return h.saveStructures(j,j.isCompatible)===!1?h.pack(w,P):(h.lastNamedStructuresLength=A,x.length>1073741824&&(x=null),_)}x.length>1073741824&&(x=null),P&Gs&&(y=n)}};const ee=()=>{X<10&&X++;let w=a.sharedLength||0;if(a.length>w&&!S&&(a.length=w),Y>1e4)a.transitions=null,X=0,Y=0,U.length>0&&(U=[]);else if(U.length>0&&!S){for(let P=0,R=U.length;P<R;P++)U[P][xt]=0;U=[]}},te=w=>{var P=w.length;P<16?x[y++]=144|P:P<65536?(x[y++]=220,x[y++]=P>>8,x[y++]=P&255):(x[y++]=221,ne.setUint32(y,P),y+=4);for(let R=0;R<P;R++)q(w[R])},q=w=>{y>ve&&(x=Ae(y));var P=typeof w,R;if(P==="string"){let A=w.length;if(oe&&A>=4&&A<4096){if((oe.size+=A)>To){let V,J=(oe[0]?oe[0].length*3+oe[1].length:0)+10;y+J>ve&&(x=Ae(y+J));let K;oe.position?(K=oe,x[y]=200,y+=3,x[y++]=98,V=y-n,y+=4,Br(n,q,0),ne.setUint16(V+n-3,y-n-V)):(x[y++]=214,x[y++]=98,V=y-n,y+=4),oe=["",""],oe.previous=K,oe.size=0,oe.position=V}let z=Ao.test(w);oe[z?0:1]+=w,x[y++]=193,q(z?-A:A);return}let _;A<32?_=1:A<256?_=2:A<65536?_=3:_=5;let j=A*3;if(y+j>ve&&(x=Ae(y+j)),A<64||!u){let z,V,J,K=y+_;for(z=0;z<A;z++)V=w.charCodeAt(z),V<128?x[K++]=V:V<2048?(x[K++]=V>>6|192,x[K++]=V&63|128):(V&64512)===55296&&((J=w.charCodeAt(z+1))&64512)===56320?(V=65536+((V&1023)<<10)+(J&1023),z++,x[K++]=V>>18|240,x[K++]=V>>12&63|128,x[K++]=V>>6&63|128,x[K++]=V&63|128):(x[K++]=V>>12|224,x[K++]=V>>6&63|128,x[K++]=V&63|128);R=K-y-_}else R=u(w,y+_);R<32?x[y++]=160|R:R<256?(_<2&&x.copyWithin(y+2,y+1,y+1+R),x[y++]=217,x[y++]=R):R<65536?(_<3&&x.copyWithin(y+3,y+2,y+2+R),x[y++]=218,x[y++]=R>>8,x[y++]=R&255):(_<5&&x.copyWithin(y+5,y+3,y+3+R),x[y++]=219,ne.setUint32(y,R),y+=4),y+=R}else if(P==="number")if(w>>>0===w)w<32||w<128&&this.useRecords===!1||w<64&&!this.randomAccessStructure?x[y++]=w:w<256?(x[y++]=204,x[y++]=w):w<65536?(x[y++]=205,x[y++]=w>>8,x[y++]=w&255):(x[y++]=206,ne.setUint32(y,w),y+=4);else if(w>>0===w)w>=-32?x[y++]=256+w:w>=-128?(x[y++]=208,x[y++]=w+256):w>=-32768?(x[y++]=209,ne.setInt16(y,w),y+=2):(x[y++]=210,ne.setInt32(y,w),y+=4);else{let A;if((A=this.useFloat32)>0&&w<4294967296&&w>=-2147483648){x[y++]=202,ne.setFloat32(y,w);let _;if(A<4||(_=w*un[(x[y]&127)<<1|x[y+1]>>7])>>0===_){y+=4;return}else y--}x[y++]=203,ne.setFloat64(y,w),y+=8}else if(P==="object"||P==="function")if(!w)x[y++]=192;else{if(f){let _=f.get(w);if(_){if(!_.id){let j=f.idsToInsert||(f.idsToInsert=[]);_.id=j.push(_)}x[y++]=214,x[y++]=112,ne.setUint32(y,_.id),y+=4;return}else f.set(w,{offset:y-n})}let A=w.constructor;if(A===Object)Ge(w);else if(A===Array)te(w);else if(A===Map)if(this.mapAsEmptyObject)x[y++]=128;else{R=w.size,R<16?x[y++]=128|R:R<65536?(x[y++]=222,x[y++]=R>>8,x[y++]=R&255):(x[y++]=223,ne.setUint32(y,R),y+=4);for(let[_,j]of w)q(_),q(j)}else{for(let _=0,j=sn.length;_<j;_++){let z=qn[_];if(w instanceof z){let V=sn[_];if(V.write){V.type&&(x[y++]=212,x[y++]=V.type,x[y++]=0);let Te=V.write.call(this,w);Te===w?Array.isArray(w)?te(w):Ge(w):q(Te);return}let J=x,K=ne,ie=y;x=null;let de;try{de=V.pack.call(this,w,Te=>(x=J,J=null,y+=Te,y>ve&&Ae(y),{target:x,targetView:ne,position:y-Te}),q)}finally{J&&(x=J,ne=K,y=ie,ve=x.length-10)}de&&(de.length+y>ve&&Ae(de.length+y),y=_o(de,x,y,V.type));return}}if(Array.isArray(w))te(w);else{if(w.toJSON){const _=w.toJSON();if(_!==w)return q(_)}if(P==="function")return q(this.writeFunction&&this.writeFunction(w));Ge(w)}}}else if(P==="boolean")x[y++]=w?195:194;else if(P==="bigint"){if(w<BigInt(1)<<BigInt(63)&&w>=-(BigInt(1)<<BigInt(63)))x[y++]=211,ne.setBigInt64(y,w);else if(w<BigInt(1)<<BigInt(64)&&w>0)x[y++]=207,ne.setBigUint64(y,w);else if(this.largeBigIntToFloat)x[y++]=203,ne.setFloat64(y,Number(w));else{if(this.largeBigIntToString)return q(w.toString());if(this.useBigIntExtension&&w<BigInt(2)**BigInt(1023)&&w>-(BigInt(2)**BigInt(1023))){x[y++]=199,y++,x[y++]=66;let A=[],_;do{let j=w&BigInt(255);_=(j&BigInt(128))===(w<BigInt(0)?BigInt(128):BigInt(0)),A.push(j),w>>=BigInt(8)}while(!((w===BigInt(0)||w===BigInt(-1))&&_));x[y-2]=A.length;for(let j=A.length;j>0;)x[y++]=Number(A[--j]);return}else throw new RangeError(w+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}y+=8}else if(P==="undefined")this.encodeUndefinedAsNil?x[y++]=192:(x[y++]=212,x[y++]=0,x[y++]=0);else throw new Error("Unknown type: "+P)},se=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?w=>{let P;if(this.skipValues){P=[];for(let _ in w)(typeof w.hasOwnProperty!="function"||w.hasOwnProperty(_))&&!this.skipValues.includes(w[_])&&P.push(_)}else P=Object.keys(w);let R=P.length;R<16?x[y++]=128|R:R<65536?(x[y++]=222,x[y++]=R>>8,x[y++]=R&255):(x[y++]=223,ne.setUint32(y,R),y+=4);let A;if(this.coercibleKeyAsNumber)for(let _=0;_<R;_++){A=P[_];let j=Number(A);q(isNaN(j)?A:j),q(w[A])}else for(let _=0;_<R;_++)q(A=P[_]),q(w[A])}:w=>{x[y++]=222;let P=y-n;y+=2;let R=0;for(let A in w)(typeof w.hasOwnProperty!="function"||w.hasOwnProperty(A))&&(q(A),q(w[A]),R++);if(R>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');x[P+++n]=R>>8,x[P+n]=R&255},Se=this.useRecords===!1?se:t.progressiveRecords&&!F?w=>{let P,R=a.transitions||(a.transitions=Object.create(null)),A=y++-n,_;for(let j in w)if(typeof w.hasOwnProperty!="function"||w.hasOwnProperty(j)){if(P=R[j],P)R=P;else{let z=Object.keys(w),V=R;R=a.transitions;let J=0;for(let K=0,ie=z.length;K<ie;K++){let de=z[K];P=R[de],P||(P=R[de]=Object.create(null),J++),R=P}A+n+1==y?(y--,ht(R,z,J)):Z(R,z,A,J),_=!0,R=V[j]}q(w[j])}if(!_){let j=R[xt];j?x[A+n]=j:Z(R,Object.keys(w),A,0)}}:w=>{let P,R=a.transitions||(a.transitions=Object.create(null)),A=0;for(let j in w)(typeof w.hasOwnProperty!="function"||w.hasOwnProperty(j))&&(P=R[j],P||(P=R[j]=Object.create(null),A++),R=P);let _=R[xt];_?_>=96&&F?(x[y++]=((_-=96)&31)+96,x[y++]=_>>5):x[y++]=_:ht(R,R.__keys__||Object.keys(w),A);for(let j in w)(typeof w.hasOwnProperty!="function"||w.hasOwnProperty(j))&&q(w[j])},ze=typeof this.useRecords=="function"&&this.useRecords,Ge=ze?w=>{ze(w)?Se(w):se(w)}:Se,Ae=w=>{let P;if(w>16777216){if(w-n>kr)throw new Error("Packed buffer would be larger than maximum buffer size");P=Math.min(kr,Math.round(Math.max((w-n)*(w>67108864?1.25:2),4194304)/4096)*4096)}else P=(Math.max(w-n<<2,x.length-1)>>12)+1<<12;let R=new zt(P);return ne=R.dataView||(R.dataView=new DataView(R.buffer,0,P)),w=Math.min(w,x.length),x.copy?x.copy(R,0,n,w):R.set(x.slice(n,w)),y-=n,n=0,ve=R.length-10,x=R},ht=(w,P,R)=>{let A=a.nextId;A||(A=64),A<B&&this.shouldShareStructure&&!this.shouldShareStructure(P)?(A=a.nextOwnId,A<H||(A=B),a.nextOwnId=A+1):(A>=H&&(A=B),a.nextId=A+1);let _=P.highByte=A>=96&&F?A-96>>5:-1;w[xt]=A,w.__keys__=P,a[A-64]=P,A<B?(P.isShared=!0,a.sharedLength=A-63,o=!0,_>=0?(x[y++]=(A&31)+96,x[y++]=_):x[y++]=A):(_>=0?(x[y++]=213,x[y++]=114,x[y++]=(A&31)+96,x[y++]=_):(x[y++]=212,x[y++]=114,x[y++]=A),R&&(Y+=X*R),U.length>=g&&(U.shift()[xt]=0),U.push(w),q(P))},Z=(w,P,R,A)=>{let _=x,j=y,z=ve,V=n;x=At,y=0,n=0,x||(At=x=new zt(8192)),ve=x.length-10,ht(w,P,A),At=x;let J=y;if(x=_,y=j,ve=z,n=V,J>1){let K=y+J-1;K>ve&&Ae(K);let ie=R+n;x.copyWithin(ie+J,ie+1,y),x.set(At.slice(0,J),ie),y=K}else x[R+n]=At[0]},Q=w=>{let P=So(w,x,n,y,a,Ae,(R,A,_)=>{if(_)return o=!0;y=A;let j=x;return q(R),ee(),j!==x?{position:y,targetView:ne,target:x}:y},this);if(P===0)return Ge(w);y=P}}useBuffer(t){x=t,x.dataView||(x.dataView=new DataView(x.buffer,x.byteOffset,x.byteLength)),y=0}set position(t){y=t}get position(){return y}set buffer(t){x=t}get buffer(){return x}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}qn=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Ms];sn=[{pack(r,t,n){let o=r.getTime()/1e3;if((this.useTimestamp32||r.getMilliseconds()===0)&&o>=0&&o<4294967296){let{target:a,targetView:f,position:u}=t(6);a[u++]=214,a[u++]=255,f.setUint32(u,o)}else if(o>0&&o<4294967296){let{target:a,targetView:f,position:u}=t(10);a[u++]=215,a[u++]=255,f.setUint32(u,r.getMilliseconds()*4e6+(o/1e3/4294967296>>0)),f.setUint32(u+4,o)}else if(isNaN(o)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:a,targetView:f,position:u}=t(3);a[u++]=212,a[u++]=255,a[u++]=255}else{let{target:a,targetView:f,position:u}=t(15);a[u++]=199,a[u++]=12,a[u++]=255,f.setUint32(u,r.getMilliseconds()*1e6),f.setBigInt64(u+4,BigInt(Math.floor(o)))}}},{pack(r,t,n){if(this.setAsEmptyObject)return t(0),n({});let o=Array.from(r),{target:a,position:f}=t(this.moreTypes?3:0);this.moreTypes&&(a[f++]=212,a[f++]=115,a[f++]=0),n(o)}},{pack(r,t,n){let{target:o,position:a}=t(this.moreTypes?3:0);this.moreTypes&&(o[a++]=212,o[a++]=101,o[a++]=0),n([r.name,r.message,r.cause])}},{pack(r,t,n){let{target:o,position:a}=t(this.moreTypes?3:0);this.moreTypes&&(o[a++]=212,o[a++]=120,o[a++]=0),n([r.source,r.flags])}},{pack(r,t){this.moreTypes?Mr(r,16,t):Lr(hn?Buffer.from(r):new Uint8Array(r),t)}},{pack(r,t){let n=r.constructor;n!==Ws&&this.moreTypes?Mr(r,Vs.indexOf(n.name),t):Lr(r,t)}},{pack(r,t){let{target:n,position:o}=t(1);n[o]=193}}];function Mr(r,t,n,o){let a=r.byteLength;if(a+1<256){var{target:f,position:u}=n(4+a);f[u++]=199,f[u++]=a+1}else if(a+1<65536){var{target:f,position:u}=n(5+a);f[u++]=200,f[u++]=a+1>>8,f[u++]=a+1&255}else{var{target:f,position:u,targetView:h}=n(7+a);f[u++]=201,h.setUint32(u,a+1),u+=4}f[u++]=116,f[u++]=t,r.buffer||(r=new Uint8Array(r)),f.set(new Uint8Array(r.buffer,r.byteOffset,r.byteLength),u)}function Lr(r,t){let n=r.byteLength;var o,a;if(n<256){var{target:o,position:a}=t(n+2);o[a++]=196,o[a++]=n}else if(n<65536){var{target:o,position:a}=t(n+3);o[a++]=197,o[a++]=n>>8,o[a++]=n&255}else{var{target:o,position:a,targetView:f}=t(n+5);o[a++]=198,f.setUint32(a,n),a+=4}o.set(r,a)}function _o(r,t,n,o){let a=r.length;switch(a){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:a<256?(t[n++]=199,t[n++]=a):a<65536?(t[n++]=200,t[n++]=a>>8,t[n++]=a&255):(t[n++]=201,t[n++]=a>>24,t[n++]=a>>16&255,t[n++]=a>>8&255,t[n++]=a&255)}return t[n++]=o,t.set(r,n),n+=a,n}function Co(r,t){let n,o=t.length*6,a=r.length-o;for(;n=t.pop();){let f=n.offset,u=n.id;r.copyWithin(f+o,f,a),o-=6;let h=f+o;r[h++]=214,r[h++]=105,r[h++]=u>>24,r[h++]=u>>16&255,r[h++]=u>>8&255,r[h++]=u&255,a=f}return r}function Br(r,t,n){if(oe.length>0){ne.setUint32(oe.position+r,y+n-oe.position-r),oe.stringsPosition=y-r;let o=oe;oe=null,t(o[0]),t(o[1])}}function $o(r){if(r.Class){if(!r.pack&&!r.write)throw new Error("Extension has no pack or write function");if(r.pack&&!r.type)throw new Error("Extension has no type (numeric code to identify the extension)");qn.unshift(r.Class),sn.unshift(r)}bo(r)}function Ro(r,t){return r.isCompatible=n=>{let o=!n||(t.lastNamedStructuresLength||0)===n.length;return o||t._mergeStructures(n),o},r}let Js=new Nt({useRecords:!1});const Po=Js.pack,Do=Js.pack,No=Nt,{NEVER:ko,ALWAYS:Mo,DECIMAL_ROUND:Lo,DECIMAL_FIT:Bo}=Hs,Ks=512,Gs=1024,Ys=2048;function jo(r,t={}){if(!r||typeof r!="object")throw new Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable");if(typeof r[Symbol.iterator]=="function")return Fo(r,t);if(typeof r.then=="function"||typeof r[Symbol.asyncIterator]=="function")return Uo(r,t);throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}function*Fo(r,t){const n=new Nt(t);for(const o of r)yield n.pack(o)}async function*Uo(r,t){const n=new Nt(t);for await(const o of r)yield n.pack(o)}function Vo(r,t={}){if(!r||typeof r!="object")throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");const n=new nt(t);let o;const a=f=>{let u;o&&(f=Buffer.concat([o,f]),o=void 0);try{u=n.unpackMultiple(f)}catch(h){if(h.incomplete)o=f.slice(h.lastPosition),u=h.values;else throw h}return u};if(typeof r[Symbol.iterator]=="function")return function*(){for(const u of r)yield*a(u)}();if(typeof r[Symbol.asyncIterator]=="function")return async function*(){for await(const u of r)yield*a(u)}()}const zo=Vo,Ho=jo,qo=!1,Wo=!0,Jo=Object.freeze(Object.defineProperty({__proto__:null,ALWAYS:Mo,C1:Vn,DECIMAL_FIT:Bo,DECIMAL_ROUND:Lo,Decoder:Eo,Encoder:No,FLOAT32_OPTIONS:Hs,NEVER:ko,Packr:Nt,RESERVE_START_SPACE:Ys,RESET_BUFFER_MODE:Gs,REUSE_BUFFER_MODE:Ks,Unpackr:nt,addExtension:$o,clearSource:rn,decode:Io,decodeIter:zo,encode:Do,encodeIter:Ho,isNativeAccelerationEnabled:mo,mapsAsObjects:Wo,pack:Po,roundFloat32:vo,unpack:xo,unpackMultiple:Oo,useRecords:qo},Symbol.toStringTag,{value:"Module"})),Ko=Nn(Jo);var Go=Rs,Ne=jn,jr=fn,Yo=Fn,Ht=Un,be=Bn,Zo=ln,Fr=Pt,Ur=Ko;let Xo=class Zs{constructor(t,n){this.onStateChange=Ht.createSignal(),this.onError=Ht.createSignal(),this.onLeave=Ht.createSignal(),this.onJoin=Ht.createSignal(),this.hasJoined=!1,this.onMessageHandlers=Yo.createNanoEvents(),this.roomId=null,this.name=t,this.packr=new Ur.Packr,this.packr.encode(void 0),n&&(this.serializer=new(jr.getSerializer("schema")),this.rootSchema=n,this.serializer.state=new n),this.onError((o,a)=>{var f;return(f=console.warn)===null||f===void 0?void 0:f.call(console,`colyseus.js - onError => (${o}) ${a}`)}),this.onLeave(()=>this.removeAllListeners())}connect(t,n,o=this,a,f){const u=new Go.Connection(a.protocol);if(o.connection=u,u.events.onmessage=Zs.prototype.onMessageCallback.bind(o),u.events.onclose=function(h){var S;if(!o.hasJoined){(S=console.warn)===null||S===void 0||S.call(console,`Room connection was closed unexpectedly (${h.code}): ${h.reason}`),o.onError.invoke(h.code,h.reason);return}h.code===Fr.CloseCode.DEVMODE_RESTART&&n?n():(o.onLeave.invoke(h.code,h.reason),o.destroy())},u.events.onerror=function(h){var S;(S=console.warn)===null||S===void 0||S.call(console,`Room, onError (${h.code}): ${h.reason}`),o.onError.invoke(h.code,h.reason)},a.protocol==="h3"){const h=new URL(t);u.connect(h.origin,a)}else u.connect(t,f)}leave(t=!0){return new Promise(n=>{this.onLeave(o=>n(o)),this.connection?t?(this.packr.buffer[0]=Ne.Protocol.LEAVE_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))):this.connection.close():this.onLeave.invoke(Fr.CloseCode.CONSENTED)})}onMessage(t,n){return this.onMessageHandlers.on(this.getMessageHandlerKey(t),n)}send(t,n){const o={offset:1};this.packr.buffer[0]=Ne.Protocol.ROOM_DATA,typeof t=="string"?be.encode.string(this.packr.buffer,t,o):be.encode.number(this.packr.buffer,t,o),this.packr.position=0;const a=n!==void 0?this.packr.pack(n,2048+o.offset):this.packr.buffer.subarray(0,o.offset);this.connection.send(a)}sendUnreliable(t,n){const o={offset:1};this.packr.buffer[0]=Ne.Protocol.ROOM_DATA,typeof t=="string"?be.encode.string(this.packr.buffer,t,o):be.encode.number(this.packr.buffer,t,o),this.packr.position=0;const a=n!==void 0?this.packr.pack(n,2048+o.offset):this.packr.buffer.subarray(0,o.offset);this.connection.sendUnreliable(a)}sendBytes(t,n){const o={offset:1};if(this.packr.buffer[0]=Ne.Protocol.ROOM_DATA_BYTES,typeof t=="string"?be.encode.string(this.packr.buffer,t,o):be.encode.number(this.packr.buffer,t,o),n.byteLength+o.offset>this.packr.buffer.byteLength){const a=new Uint8Array(o.offset+n.byteLength);a.set(this.packr.buffer),this.packr.useBuffer(a)}this.packr.buffer.set(n,o.offset),this.connection.send(this.packr.buffer.subarray(0,o.offset+n.byteLength))}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={},this.serializer instanceof Zo.SchemaSerializer&&(this.serializer.decoder.root.callbacks={})}onMessageCallback(t){const n=new Uint8Array(t.data),o={offset:1},a=n[0];if(a===Ne.Protocol.JOIN_ROOM){const f=be.decode.utf8Read(n,o,n[o.offset++]);if(this.serializerId=be.decode.utf8Read(n,o,n[o.offset++]),!this.serializer){const u=jr.getSerializer(this.serializerId);this.serializer=new u}n.byteLength>o.offset&&this.serializer.handshake&&this.serializer.handshake(n,o),this.reconnectionToken=`${this.roomId}:${f}`,this.hasJoined=!0,this.onJoin.invoke(),this.packr.buffer[0]=Ne.Protocol.JOIN_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))}else if(a===Ne.Protocol.ERROR){const f=be.decode.number(n,o),u=be.decode.string(n,o);this.onError.invoke(f,u)}else if(a===Ne.Protocol.LEAVE_ROOM)this.leave();else if(a===Ne.Protocol.ROOM_STATE)this.serializer.setState(n,o),this.onStateChange.invoke(this.serializer.getState());else if(a===Ne.Protocol.ROOM_STATE_PATCH)this.serializer.patch(n,o),this.onStateChange.invoke(this.serializer.getState());else if(a===Ne.Protocol.ROOM_DATA){const f=be.decode.stringCheck(n,o)?be.decode.string(n,o):be.decode.number(n,o),u=n.byteLength>o.offset?Ur.unpack(n,{start:o.offset}):void 0;this.dispatchMessage(f,u)}else if(a===Ne.Protocol.ROOM_DATA_BYTES){const f=be.decode.stringCheck(n,o)?be.decode.string(n,o):be.decode.number(n,o);this.dispatchMessage(f,n.subarray(o.offset))}}dispatchMessage(t,n){var o;const a=this.getMessageHandlerKey(t);this.onMessageHandlers.events[a]?this.onMessageHandlers.emit(a,n):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",t,n):(o=console.warn)===null||o===void 0||o.call(console,`colyseus.js: onMessage() not registered for type '${t}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(t){switch(typeof t){case"string":return t;case"number":return`i${t}`;default:throw new Error("invalid message type.")}}};Ln.Room=Xo;var Xs={};function Vr(r,t){t.headers=r.headers||{},t.statusMessage=r.statusText,t.statusCode=r.status,t.data=r.response}function je(r,t,n){return new Promise(function(o,a){n=n||{};var f=new XMLHttpRequest,u,h,S,v=n.body,$=n.headers||{};n.timeout&&(f.timeout=n.timeout),f.ontimeout=f.onerror=function(g){g.timeout=g.type=="timeout",a(g)},f.onabort=function(g){g.aborted=!0,a(g)},f.open(r,t.href||t),f.onload=function(){for(S=f.getAllResponseHeaders().trim().split(/[\r\n]+/),Vr(f,f);h=S.shift();)h=h.split(": "),f.headers[h.shift().toLowerCase()]=h.join(": ");if(h=f.headers["content-type"],h&&~h.indexOf("application/json"))try{f.data=JSON.parse(f.data,n.reviver)}catch(g){return Vr(f,g),a(g)}(f.status>=400?a:o)(f)},typeof FormData<"u"&&v instanceof FormData||v&&typeof v=="object"&&($["content-type"]="application/json",v=JSON.stringify(v)),f.withCredentials=!!n.withCredentials;for(u in $)f.setRequestHeader(u,$[u]);f.send(v),n.signal&&n.signal.addEventListener("abort",function(){f.abort()})})}var Qo=je.bind(je,"GET"),ea=je.bind(je,"POST"),ta=je.bind(je,"PATCH"),na=je.bind(je,"DELETE"),ra=je.bind(je,"PUT");const sa=Object.freeze(Object.defineProperty({__proto__:null,del:na,get:Qo,patch:ta,post:ea,put:ra,send:je},Symbol.toStringTag,{value:"Module"})),ia=Nn(sa);var zr=Pt,oa=ia;function aa(r){var t=Object.create(null);return r&&Object.keys(r).forEach(function(n){if(n!=="default"){var o=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return r[n]}})}}),t.default=r,Object.freeze(t)}var ca=aa(oa);let fa=class{constructor(t,n={}){this.client=t,this.headers=n}get(t,n={}){return this.request("get",t,n)}post(t,n={}){return this.request("post",t,n)}del(t,n={}){return this.request("del",t,n)}put(t,n={}){return this.request("put",t,n)}request(t,n,o={}){return ca[t](this.client.getHttpEndpoint(n),this.getOptions(o)).catch(a=>{var f;if(a.aborted)throw new zr.AbortError("Request aborted");const u=a.statusCode,h=((f=a.data)===null||f===void 0?void 0:f.error)||a.statusMessage||a.message;throw!u&&!h?a:new zr.ServerError(u,h)})}getOptions(t){return t.headers=Object.assign({},this.headers,t.headers),this.authToken&&(t.headers.Authorization=`Bearer ${this.authToken}`),typeof cc<"u"&&cc.sys&&cc.sys.isNative||(t.withCredentials=!0),t}};Xs.HTTP=fa;var Wn={},gn={},Hr=cn;let lt;function Jn(){if(!lt)try{lt=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch{}return!lt&&typeof globalThis.indexedDB<"u"&&(lt=new ha),lt||(lt={cache:{},setItem:function(r,t){this.cache[r]=t},getItem:function(r){this.cache[r]},removeItem:function(r){delete this.cache[r]}}),lt}function la(r,t){Jn().setItem(r,t)}function ua(r){Jn().removeItem(r)}function da(r,t){const n=Jn().getItem(r);typeof Promise>"u"||!(n instanceof Promise)?t(n):n.then(o=>t(o))}class ha{constructor(){this.dbPromise=new Promise(t=>{const n=indexedDB.open("_colyseus_storage",1);n.onupgradeneeded=()=>n.result.createObjectStore("store"),n.onsuccess=()=>t(n.result)})}tx(t,n){return Hr.__awaiter(this,void 0,void 0,function*(){const a=(yield this.dbPromise).transaction("store",t).objectStore("store");return n(a)})}setItem(t,n){return this.tx("readwrite",o=>o.put(n,t)).then()}getItem(t){return Hr.__awaiter(this,void 0,void 0,function*(){const n=yield this.tx("readonly",o=>o.get(t));return new Promise(o=>{n.onsuccess=()=>o(n.result)})})}removeItem(t){return this.tx("readwrite",n=>n.delete(t)).then()}}gn.getItem=da;gn.removeItem=ua;gn.setItem=la;var ge=cn,vn=gn,ga=Fn,Kt,Pn,Qe,Gt;let ma=class{constructor(t){this.http=t,this.settings={path:"/auth",key:"colyseus-auth-token"},Kt.set(this,!1),Pn.set(this,void 0),Qe.set(this,void 0),Gt.set(this,ga.createNanoEvents()),vn.getItem(this.settings.key,n=>this.token=n)}set token(t){this.http.authToken=t}get token(){return this.http.authToken}onChange(t){const n=ge.__classPrivateFieldGet(this,Gt,"f").on("change",t);return ge.__classPrivateFieldGet(this,Kt,"f")||ge.__classPrivateFieldSet(this,Pn,new Promise((o,a)=>{this.getUserData().then(f=>{this.emitChange(Object.assign(Object.assign({},f),{token:this.token}))}).catch(f=>{this.emitChange({user:null,token:void 0})}).finally(()=>{o()})}),"f"),ge.__classPrivateFieldSet(this,Kt,!0,"f"),n}getUserData(){return ge.__awaiter(this,void 0,void 0,function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")})}registerWithEmailAndPassword(t,n,o){return ge.__awaiter(this,void 0,void 0,function*(){const a=(yield this.http.post(`${this.settings.path}/register`,{body:{email:t,password:n,options:o}})).data;return this.emitChange(a),a})}signInWithEmailAndPassword(t,n){return ge.__awaiter(this,void 0,void 0,function*(){const o=(yield this.http.post(`${this.settings.path}/login`,{body:{email:t,password:n}})).data;return this.emitChange(o),o})}signInAnonymously(t){return ge.__awaiter(this,void 0,void 0,function*(){const n=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:t}})).data;return this.emitChange(n),n})}sendPasswordResetEmail(t){return ge.__awaiter(this,void 0,void 0,function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:t}})).data})}signInWithProvider(t){return ge.__awaiter(this,arguments,void 0,function*(n,o={}){return new Promise((a,f)=>{const u=o.width||480,h=o.height||768,S=this.token?`?token=${this.token}`:"",v=`Login with ${n[0].toUpperCase()+n.substring(1)}`,$=this.http.client.getHttpEndpoint(`${o.prefix||`${this.settings.path}/provider`}/${n}${S}`),g=screen.width/2-u/2,F=screen.height/2-h/2;ge.__classPrivateFieldSet(this,Qe,window.open($,v,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+u+", height="+h+", top="+F+", left="+g),"f");const B=U=>{U.data.user===void 0&&U.data.token===void 0||(clearInterval(H),ge.__classPrivateFieldGet(this,Qe,"f").close(),ge.__classPrivateFieldSet(this,Qe,void 0,"f"),window.removeEventListener("message",B),U.data.error!==void 0?f(U.data.error):(a(U.data),this.emitChange(U.data)))},H=setInterval(()=>{(!ge.__classPrivateFieldGet(this,Qe,"f")||ge.__classPrivateFieldGet(this,Qe,"f").closed)&&(ge.__classPrivateFieldSet(this,Qe,void 0,"f"),f("cancelled"),window.removeEventListener("message",B))},200);window.addEventListener("message",B)})})}signOut(){return ge.__awaiter(this,void 0,void 0,function*(){this.emitChange({user:null,token:null})})}emitChange(t){t.token!==void 0&&(this.token=t.token,t.token===null?vn.removeItem(this.settings.key):vn.setItem(this.settings.key,t.token)),ge.__classPrivateFieldGet(this,Gt,"f").emit("change",t)}};Kt=new WeakMap,Pn=new WeakMap,Qe=new WeakMap,Gt=new WeakMap;Wn.Auth=ma;var Qs={};function pa(r){var t;const n=((t=window?.location)===null||t===void 0?void 0:t.hostname)||"localhost",o=r.hostname.split("."),a=!r.hostname.includes("trycloudflare.com")&&!r.hostname.includes("discordsays.com")&&o.length>2?`/${o[0]}`:"";return r.pathname.startsWith("/.proxy")?`${r.protocol}//${n}${a}${r.pathname}${r.search}`:`${r.protocol}//${n}/.proxy/colyseus${a}${r.pathname}${r.search}`}Qs.discordURLBuilder=pa;var We=cn,ya=Pt,wa=Ln,ba=Xs,Ea=Wn,xa=Qs,Sn;class mn extends Error{constructor(t,n){super(t),this.code=n,this.name="MatchMakeError",Object.setPrototypeOf(this,mn.prototype)}}const qr=typeof window<"u"&&typeof((Sn=window?.location)===null||Sn===void 0?void 0:Sn.hostname)<"u"?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";class ei{constructor(t=qr,n){var o,a;if(typeof t=="string"){const f=t.startsWith("/")?new URL(t,qr):new URL(t),u=f.protocol==="https:"||f.protocol==="wss:",h=Number(f.port||(u?443:80));this.settings={hostname:f.hostname,pathname:f.pathname,port:h,secure:u,searchParams:f.searchParams.toString()||void 0}}else t.port===void 0&&(t.port=t.secure?443:80),t.pathname===void 0&&(t.pathname=""),this.settings=t;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new ba.HTTP(this,n?.headers||{}),this.auth=new Ea.Auth(this.http),this.urlBuilder=n?.urlBuilder,!this.urlBuilder&&typeof window<"u"&&(!((a=(o=window?.location)===null||o===void 0?void 0:o.hostname)===null||a===void 0)&&a.includes("discordsays.com"))&&(this.urlBuilder=xa.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(t){return We.__awaiter(this,arguments,void 0,function*(n,o={},a){return yield this.createMatchMakeRequest("joinOrCreate",n,o,a)})}create(t){return We.__awaiter(this,arguments,void 0,function*(n,o={},a){return yield this.createMatchMakeRequest("create",n,o,a)})}join(t){return We.__awaiter(this,arguments,void 0,function*(n,o={},a){return yield this.createMatchMakeRequest("join",n,o,a)})}joinById(t){return We.__awaiter(this,arguments,void 0,function*(n,o={},a){return yield this.createMatchMakeRequest("joinById",n,o,a)})}reconnect(t,n){return We.__awaiter(this,void 0,void 0,function*(){if(typeof t=="string"&&typeof n=="string")throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[o,a]=t.split(":");if(!o||!a)throw new Error(`Invalid reconnection token format.
The format should be roomId:reconnectionToken`);return yield this.createMatchMakeRequest("reconnect",o,{reconnectionToken:a},n)})}consumeSeatReservation(t,n,o){return We.__awaiter(this,void 0,void 0,function*(){const a=this.createRoom(t.room.name,n);a.roomId=t.room.roomId,a.sessionId=t.sessionId;const f={sessionId:a.sessionId};t.reconnectionToken&&(f.reconnectionToken=t.reconnectionToken);const u=o||a;return a.connect(this.buildEndpoint(t.room,f,t.protocol),t.devMode&&(()=>We.__awaiter(this,void 0,void 0,function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${a.roomId}'...`);let h=0,S=8;const v=()=>We.__awaiter(this,void 0,void 0,function*(){h++;try{yield this.consumeSeatReservation(t,n,u),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${a.roomId}'`)}catch{h<S?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${h} out of ${S})`),setTimeout(v,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}});setTimeout(v,2e3)})),u,t,this.http.headers),new Promise((h,S)=>{const v=($,g)=>S(new ya.ServerError($,g));u.onError.once(v),u.onJoin.once(()=>{u.onError.remove(v),h(u)})})})}createMatchMakeRequest(t,n){return We.__awaiter(this,arguments,void 0,function*(o,a,f={},u,h){const S=(yield this.http.post(`matchmake/${o}/${a}`,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(f)})).data;if(S.error)throw new mn(S.error,S.code);return o==="reconnect"&&(S.reconnectionToken=f.reconnectionToken),yield this.consumeSeatReservation(S,u,h)})}createRoom(t,n){return new wa.Room(t,n)}buildEndpoint(t,n={},o="ws"){let a=this.settings.searchParams||"";this.http.authToken&&(n._authToken=this.http.authToken);for(const h in n)n.hasOwnProperty(h)&&(a+=(a?"&":"")+`${h}=${n[h]}`);o==="h3"&&(o="http");let f=this.settings.secure?`${o}s://`:`${o}://`;t.publicAddress?f+=`${t.publicAddress}`:f+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const u=`${f}/${t.processId}/${t.roomId}?${a}`;return this.urlBuilder?this.urlBuilder(new URL(u)):u}getHttpEndpoint(t=""){const n=t.startsWith("/")?t:`/${t}`;let o=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${n}`;return this.settings.searchParams&&(o+=`?${this.settings.searchParams}`),this.urlBuilder?this.urlBuilder(new URL(o)):o}getEndpointPort(){return this.settings.port!==80&&this.settings.port!==443?`:${this.settings.port}`:""}}ei.VERSION="0.16.19";kn.Client=ei;kn.MatchMakeError=mn;var ti={};class Oa{setState(t){}getState(){return null}patch(t){}teardown(){}handshake(t){}}ti.NoneSerializer=Oa;(function(r){var t=kn,n=jn,o=Ln,a=Wn,f=Pt,u=ln,h=ti,S=fn;S.registerSerializer("schema",u.SchemaSerializer),S.registerSerializer("none",h.NoneSerializer),r.Client=t.Client,r.MatchMakeError=t.MatchMakeError,Object.defineProperty(r,"ErrorCode",{enumerable:!0,get:function(){return n.ErrorCode}}),Object.defineProperty(r,"Protocol",{enumerable:!0,get:function(){return n.Protocol}}),r.Room=o.Room,r.Auth=a.Auth,r.ServerError=f.ServerError,r.SchemaSerializer=u.SchemaSerializer,r.getStateCallbacks=u.getStateCallbacks,r.registerSerializer=S.registerSerializer})(rs);var Ia=dt("<div class=app-container><div class=header><h1>🎮 Gameserver Test</h1><p>SolidJS Frontend mit Colyseus Backend</p></div><div class=card><div class=connection-section><div>"),va=dt("<button class=btn>"),Sa=dt('<button class="btn danger">Verbindung trennen'),Ta=dt("<div class=card><h3>📊 Raum Informationen</h3><div class=room-info><div class=info-item><h4>Raum ID</h4><p></p></div><div class=info-item><h4>Synchronisierte Eigenschaft</h4><p></p></div><div class=info-item><h4>Spieler im Raum</h4><p>"),Aa=dt('<div class=card><h3>💬 Nachrichten</h3><div class=message-form><input class=message-input type=text placeholder="Nachricht eingeben..."><button class="btn success">Senden</button></div><div class=messages-list>'),_a=dt("<div class=message-item><div class=message-time> - </div><div class=message-content>"),Ca=dt("<p style=text-align:center>Noch keine Nachrichten...");const $a=()=>{const[r,t]=Be(null),[n,o]=Be(null),[a,f]=Be(!1),[u,h]=Be(!1),[S,v]=Be(null),[$,g]=Be(""),[F,B]=Be(""),[H,U]=Be([]),[Y,X]=Be(0),[ee,te]=Be("");let q=0;const se=(Z,Q="system")=>{const w={id:++q,content:Z,timestamp:new Date,type:Q};U(P=>[...P,w])};Pi(()=>{const Z=new rs.Client("ws://localhost:2567");t(Z),se("Client initialized. Ready to connect to server.","system")}),Gr(()=>{const Z=n();Z&&Z.leave()});const Se=async()=>{const Z=r();if(!(!Z||u())){h(!0),se("Connecting to room...","system");try{const Q=await Z.joinOrCreate("my_room");o(Q),f(!0),h(!1),v(Q.state),te(Q.roomId),g(Q.state.mySynchronizedProperty),se(`Connected to room: ${Q.roomId}`,"system"),Q.onStateChange(w=>{console.log("Room state changed:",w),v(w),g(w.mySynchronizedProperty)}),Q.onMessage("type",w=>{se(w,"received")}),Q.onMessage("player-joined",w=>{se(`Player ${w.sessionId} joined the room`,"system"),X(P=>P+1)}),Q.onMessage("player-left",w=>{se(`Player ${w.sessionId} left the room`,"system"),X(P=>Math.max(0,P-1))}),Q.onLeave(w=>{f(!1),o(null),v(null),te(""),X(0),g(""),se(`Disconnected from room (code: ${w})`,"system")}),Q.onError((w,P)=>{se(`Room error (${w}): ${P}`,"system")}),X(Object.keys(Q.state).length)}catch(Q){console.error("Failed to connect to room:",Q),h(!1),se(`Failed to connect: ${Q}`,"system")}}},ze=()=>{const Z=n(),Q=F().trim();Z&&Q&&(Z.send("type",Q),se(Q,"sent"),B(""))},Ge=Z=>{Z.key==="Enter"&&!Z.shiftKey&&(Z.preventDefault(),ze())},Ae=()=>{const Z=n();Z&&Z.leave()},ht=Z=>Z.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit",second:"2-digit"});return(()=>{var Z=Ia(),Q=Z.firstChild,w=Q.nextSibling,P=w.firstChild,R=P.firstChild;return Re(R,(()=>{var A=Tt(()=>!!u());return()=>A()?"Verbindung wird hergestellt...":a()?"✅ Verbunden":"❌ Getrennt"})()),Re(P,(()=>{var A=Tt(()=>!a());return()=>A()?(()=>{var _=va();return _.$$click=Se,Re(_,()=>u()?"Verbinde...":"Mit Raum verbinden"),ut(()=>_.disabled=!r()||u()),_})():(()=>{var _=Sa();return _.$$click=Ae,_})()})(),null),Re(Z,(()=>{var A=Tt(()=>!!(a()&&S()));return()=>A()&&[(()=>{var _=Ta(),j=_.firstChild,z=j.nextSibling,V=z.firstChild,J=V.firstChild,K=J.nextSibling,ie=V.nextSibling,de=ie.firstChild,Te=de.nextSibling,It=ie.nextSibling,st=It.firstChild,Oe=st.nextSibling;return Re(K,ee),Re(Te,$),Re(Oe,Y),_})(),(()=>{var _=Aa(),j=_.firstChild,z=j.nextSibling,V=z.firstChild,J=V.nextSibling,K=z.nextSibling;return V.addEventListener("keypress",Ge),V.$$input=ie=>B(ie.currentTarget.value),J.$$click=ze,Re(K,ts(ji,{get each(){return H()},children:ie=>(()=>{var de=_a(),Te=de.firstChild,It=Te.firstChild,st=Te.nextSibling;return Re(Te,()=>ht(ie.timestamp),It),Re(Te,(()=>{var Oe=Tt(()=>ie.type==="sent");return()=>Oe()?"Du":ie.type==="received"?"Empfangen":"System"})(),null),Re(st,()=>ie.content),de})()}),null),Re(K,(()=>{var ie=Tt(()=>H().length===0);return()=>ie()&&(()=>{var de=Ca();return Hi(de,"color","#6c757d"),de})()})(),null),ut(()=>J.disabled=!F().trim()),ut(()=>V.value=F()),_})()]})(),null),ut(()=>zi(R,`status ${a()?"connected":"disconnected"}`)),Z})()};Vi(["click","input"]);const Ra=document.getElementById("root");Ui(()=>ts($a,{}),Ra);
